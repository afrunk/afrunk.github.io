<!DOCTYPE html>
<html lang>
  <head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">

<meta name="theme-color" content="#f8f5ec">
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="description" content="Django_mooc_Spider"><meta name="keywords" content="Django, afrunk"><link rel="alternate" href="/default" title="afrunk"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.11.0">
<link rel="canonical" href="http://afrunk.github.io/2020/03/27/18-Django-mooc-Spider/">

<link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css"><link rel="stylesheet" type="text/css" href="/lib/nprogress/nprogress.min.css"><script type="text/x-mathjax-config">
    MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });
  </script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.11.0">

<script id="baidu_push">
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<script>
  window.config = {"leancloud":{"app_id":null,"app_key":null},"toc":true,"fancybox":true,"pjax":true,"latex":true};
</script>

    <title>Django_mooc_Spider - afrunk</title>
  </head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">afrunk</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list"><a href="/">
        <li class="mobile-menu-item">Home
          </li>
      </a><a href="/archives/">
        <li class="mobile-menu-item">Archivew
          </li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags
          </li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories
          </li>
      </a><a href="/MachineLearning/">
        <li class="mobile-menu-item">机器学习
          </li>
      </a></ul>
</nav>
<div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">afrunk</a>
</div>

<nav class="site-navbar"><ul id="menu" class="menu"><li class="menu-item">
          <a class="menu-item-link" href="/">
            Home
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            Archivew
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/tags/">
            Tags
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/categories/">
            Categories
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/MachineLearning/">
            机器学习
            </a>
        </li>
      </ul></nav>
</header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content"><article class="post">
    <header class="post-header">
      <h1 class="post-title">Django_mooc_Spider
        </h1>

      <div class="post-meta">
        <span class="post-time">
          2020-03-27
        </span><span class="post-category">
            <a href="/categories/实战项目/">实战项目</a>
            </span>
        </div>
    </header>

    <div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">文章目录</h2>
    <div class="post-toc-content">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#创建一个-Django-项目"><span class="toc-text">创建一个 Django 项目</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#用户模块"><span class="toc-text">用户模块</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Boards-页面"><span class="toc-text">Boards 页面</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#设置"><span class="toc-text">设置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Urls"><span class="toc-text">Urls</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Models"><span class="toc-text">Models</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#View"><span class="toc-text">View</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Teamplates"><span class="toc-text">Teamplates</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Spyder"><span class="toc-text">Spyder</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Data-migration"><span class="toc-text">Data migration</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Course-List"><span class="toc-text">Course List</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#根据评分、学习人数排序"><span class="toc-text">根据评分、学习人数排序</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#收藏功能"><span class="toc-text">收藏功能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ManyToMany"><span class="toc-text">ManyToMany</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ajax-异步查询传递数据"><span class="toc-text">Ajax 异步查询传递数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Search"><span class="toc-text">Search</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Like"><span class="toc-text">Like</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Data-Analysis"><span class="toc-text">Data Analysis</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Echart"><span class="toc-text">Echart</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pandas-amp-Matplotlib"><span class="toc-text">Pandas &amp; Matplotlib</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Django-Analysis"><span class="toc-text">Django Analysis</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#其他"><span class="toc-text">其他</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#未登录不可访问"><span class="toc-text">未登录不可访问</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#散点图分布"><span class="toc-text">散点图分布</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spyder-优化"><span class="toc-text">Spyder 优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#定时更新"><span class="toc-text">定时更新</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Conclusions"><span class="toc-text">Conclusions</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Reference"><span class="toc-text">Reference</span></a></li></ol>
    </div>
  </div><div class="post-content"><p>从三大 Mooc 平台：<a href="https://www.baidu.com/link?url=Z86Z4fjSGWN2OZiZI27Pte84O0qST7ILKPfEkP3myAwtVp9kngOlaOTA8ZbrzRgy&amp;wd=&amp;eqid=de92bee9000ce1b1000000045e7da498" target="_blank" rel="noopener">黑马培训</a>、<a href="https://www.baidu.com/link?url=4VKESJMB-iGN1uXr9vfVGGIddsNkEA9t8tJRbNzo_Xa&amp;wd=&amp;eqid=930072ba0001f048000000055e7da4a2" target="_blank" rel="noopener">慕课网</a>、<a href="https://www.baidu.com/link?url=lsIg1hPnXrj6Ghk3y5HsWbRs_5qRA7Xx9JtVHyaObyFi2O7jMOh5iGx-MzseoYVN&amp;wd=&amp;eqid=99a32a0b0004e0c0000000055e7da4ab" target="_blank" rel="noopener">中国大学MOOC</a> 中抓取免费的课程的四个大类：Java、C\C++#、Python、网络安全 下课程的基本信息，存入 Mysql 数据，然后在 Django Web 上做一个展示。该 Web 具有注册、登录、注销、修改密码、重置密码等功能，具体包括分类展示不同类别的课程列表信息、用户界面和收藏课程信息、可视化分析页面等。<br><a id="more"></a></p>
<p>环境</p>
<ul>
<li>django 2.2</li>
<li>Python 3.7</li>
<li>Mysql 8.0</li>
</ul>
<h1 id="创建一个-Django-项目"><a href="#创建一个-Django-项目" class="headerlink" title="创建一个 Django 项目"></a>创建一个 Django 项目</h1><p><img src="1.png" alt></p>
<h1 id="用户模块"><a href="#用户模块" class="headerlink" title="用户模块"></a>用户模块</h1><p>参考教程 <a href="https://afrunk.github.io/2020/03/23/10-A%20Complete%20Beginner%60s%20Guide%20to%20Django%E2%80%94%E2%80%94What%20is%20Django/">What is  Django?</a>、<a href="https://afrunk.github.io/2020/03/23/11-A-Complete-Beginner-s-Guide-to-Django/">model Fundamentals</a>、<a href="https://afrunk.github.io/2020/03/23/12-A%20Complete%20Beginner%60s%20Guide%20to%20Django%20--%20Other%60s%20Fundamentals/">Other parts of principle</a>、<a href="https://afrunk.github.io/2020/03/24/14-A%20Complete%20Beginner%60s%20Guide%20to%20Django%20--%20Advanced%20Concepts/">Advanced Concepts</a>、<a href="https://afrunk.github.io/2020/03/25/15-A%20Complete%20Beginner%60s%20Guide%20to%20Django%20--%20User%20module/">User module</a>，按照这些文章下来之后，我们就可以得到如下的页面。</p>
<p><img src="2.png" alt></p>
<p>如果你不想去执行上面的文章的操作，你可以直接下载 <a href="https://github.com/afrunk/A-Complete-Beginner-s-Guide-to-Django/tree/auth" target="_blank" rel="noopener">Github A Complete beginner`s Guide to Django</a> 的文件，着重看一下 <a href="https://afrunk.github.io/2020/03/25/15-A%20Complete%20Beginner%60s%20Guide%20to%20Django%20--%20User%20module/">User module</a>即可，这有这部分是主要讲解用户模块的内容，然后修改数据库的设置迁移数据到我们的数据库即可</p>
<p><img src="3.png" alt></p>
<p>然后我们来迁移数据</p>
<p><img src="4.png" alt></p>
<p>就可以在数据库查询到新建好的表</p>
<p><img src="5.png" alt></p>
<p>我们可以来测试下功能，点击右上角的 <strong>Signup</strong> ，进入注册页面注册账户</p>
<p><img src="6.png" alt></p>
<p>注册好了之后即会在页面上显示我们的账户名。我们还可以选择进入用户页面，会显示一些基本信息以及收藏的课程信息。下拉菜单还有修改密码、注销等等。</p>
<p><img src="7.png" alt></p>
<p>我们选择注销，点击 <strong>Login</strong> 按钮。在这个页面我们可以跳转到注册页面，还可以选择忘记密码，本项目支持发送邮件重置密码。</p>
<p><img src="8.png" alt></p>
<p>选择忘记密码，需要你输入之前注册时输入的邮箱，如果你输入的邮箱在数据库不存在，则不会给你发送重置邮件</p>
<p><img src="9.png" alt></p>
<p>点击发送之后跳转至提醒发送成功邮件页面</p>
<p><img src="10.png" alt></p>
<p>我们进入到邮箱 查看收到的邮件</p>
<p><img src="11.png" alt></p>
<p>点击链接就可以进入到重置密码的页面，注意，我们并没有添加域名，你只能在当前测试环境中测试是否可以修改密码。如果你想要修改发送邮件的账号，请在设置中进行修改即 <code>myproject/settings.py</code>,如下页面</p>
<p><img src="16.png" alt></p>
<p><img src="12.png" alt></p>
<p>点击链接之后 Django 会判断该链接是否是合适的链接，这个是 Django 内置的模块实现。当我们修改密码之后，如果密码过于简单会再次提醒你密码过于常见，修改一个难度合适的代码之后，会跳转到成功修改页面，会提供跳转至登录页面。</p>
<p><img src="13.png" alt></p>
<h1 id="Boards-页面"><a href="#Boards-页面" class="headerlink" title="Boards 页面"></a>Boards 页面</h1><p>我们现在来开发模块信息页面，因为我们的页面上没有任何的内容，我们进入数据库添加一些信息</p>
<p><img src="14.png" alt></p>
<p>再次来到首页，发现我们的首页添加了一些信息。</p>
<p><img src="15.png" alt></p>
<p>将我们不需要的内容进行一个删减,最后的目录如下</p>
<p><img src="17.png" alt></p>
<p>下面会将 Django MTV 的流程进行一个详细的讲解</p>
<h2 id="设置"><a href="#设置" class="headerlink" title="设置"></a>设置</h2><p>我们将 <strong>myproject/settings.py</strong> 中我们改动的设置进行一个列举,因为我们只需要用到两个 APP，所以大家注意后续我们并不需要对设置文件再进行操作<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">#...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">INSTALLED_APPS = [</span><br><span class="line">    &apos;django.contrib.admin&apos;,</span><br><span class="line">    &apos;django.contrib.auth&apos;,</span><br><span class="line">    &apos;django.contrib.contenttypes&apos;,</span><br><span class="line">    &apos;django.contrib.sessions&apos;,</span><br><span class="line">    &apos;django.contrib.messages&apos;,</span><br><span class="line">    &apos;django.contrib.staticfiles&apos;,</span><br><span class="line"></span><br><span class="line">    &apos;widget_tweaks&apos;,</span><br><span class="line">    # 新建的两个app</span><br><span class="line">    &apos;boards&apos;,</span><br><span class="line">    &apos;accounts&apos;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">LANGUAGE_CODE = &apos;zh-hans&apos; # 语言</span><br><span class="line"></span><br><span class="line">TIME_ZONE = &apos;Asia/Shanghai&apos; # 时区</span><br><span class="line"></span><br><span class="line"># 跳转设置 无论从什么链接进入都会跳转到首页</span><br><span class="line">LOGOUT_REDIRECT_URL = &apos;/&apos;</span><br><span class="line">LOGIN_REDIRECT_URL = &apos;/&apos;</span><br><span class="line"># 未登录用户进行收藏操作会提醒转到登录页面</span><br><span class="line">LOGIN_URL = &apos;login&apos;</span><br><span class="line"></span><br><span class="line"># 重置密码邮件部分</span><br><span class="line">EMAIL_HOST = &apos;smtp.qq.com&apos;</span><br><span class="line">EMAIL_PORT = 25   #发件箱的smtp服务器端口</span><br><span class="line">EMAIL_HOST_USER = &apos;aaa@qq.com&apos; # 你的 QQ邮箱 账号</span><br><span class="line">EMAIL_HOST_PASSWORD = &apos;sadsakdjskaj&apos;#QQ邮箱授权码</span><br><span class="line">EMAIL_USE_TLS = True # 这里必须是 True，否则发送不成功</span><br><span class="line">EMAIL_FROM = &apos;aaa@qq.com&apos; # # 你的 QQ邮箱 账号</span><br><span class="line">DEFAULT_FROM_EMAIL = &apos;aaa@qq.com&apos;# 你的 QQ邮箱 账号</span><br></pre></td></tr></table></figure></p>
<h2 id="Urls"><a href="#Urls" class="headerlink" title="Urls"></a>Urls</h2><p><strong>myproject/urls.py</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"># 后台管理模块</span><br><span class="line">from django.contrib import admin</span><br><span class="line"># 路由匹配模块</span><br><span class="line">from django.urls import path,re_path</span><br><span class="line"># 注册路由模块</span><br><span class="line">from django.contrib.auth import views as auth_views</span><br><span class="line"># 从两个 app 中引入视图函数</span><br><span class="line">from boards import views</span><br><span class="line"># 做一个重命名 避免产生冲突</span><br><span class="line">from accounts import views as accounts_views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    # 以下部分全部是用户部分的路由</span><br><span class="line">    path(&apos;admin/&apos;, admin.site.urls),</span><br><span class="line">    # 注册</span><br><span class="line">    path(&apos;signup/&apos;,accounts_views.signup,name=&apos;signup&apos;),</span><br><span class="line">    # 登出</span><br><span class="line">    path(&apos;logout/&apos;, auth_views.LogoutView.as_view(), name=&apos;logout&apos;),</span><br><span class="line">    # 登录</span><br><span class="line">    path(&apos;login/&apos;,auth_views.LoginView.as_view(template_name=&apos;login.html&apos;), name=&apos;login&apos;),</span><br><span class="line">    # 重置密码</span><br><span class="line">    path(&apos;reset/&apos;,</span><br><span class="line">        auth_views.PasswordResetView.as_view(</span><br><span class="line">            template_name=&apos;password_reset.html&apos;,</span><br><span class="line">            email_template_name=&apos;password_reset_email.html&apos;,</span><br><span class="line">            subject_template_name=&apos;password_reset_subject.txt&apos;</span><br><span class="line">        ),name=&apos;password_reset&apos;),</span><br><span class="line">    # 重置成功界面</span><br><span class="line">    path(&apos;reset/done/&apos;,</span><br><span class="line">        auth_views.PasswordResetDoneView.as_view(template_name=&apos;password_reset_done.html&apos;),</span><br><span class="line">        name=&apos;password_reset_done&apos;),</span><br><span class="line">    # 重置链接路由 我们采用 re_path 的匹配方法来进行</span><br><span class="line">    re_path(&apos;^reset/(?P&lt;uidb64&gt;[0-9A-Za-z_\-]+)/(?P&lt;token&gt;[0-9A-Za-z]&#123;1,13&#125;-[0-9A-Za-z]&#123;1,20&#125;)/$&apos;,</span><br><span class="line">        auth_views.PasswordResetConfirmView.as_view(template_name=&apos;password_reset_confirm.html&apos;),</span><br><span class="line">        name=&apos;password_reset_confirm&apos;),</span><br><span class="line">    # 重置密码成功界面</span><br><span class="line">    path(&apos;reset/complete/&apos;,</span><br><span class="line">        auth_views.PasswordResetCompleteView.as_view(template_name=&apos;password_reset_complete.html&apos;),</span><br><span class="line">        name=&apos;password_reset_complete&apos;),</span><br><span class="line"></span><br><span class="line">    # 修改密码界面</span><br><span class="line">    path(r&apos;settings/password/&apos;, auth_views.PasswordChangeView.as_view(template_name=&apos;password_change.html&apos;),</span><br><span class="line">        name=&apos;password_change&apos;),</span><br><span class="line">    # 修改密码成功界面</span><br><span class="line">    path(r&apos;settings/password/done/&apos;, auth_views.PasswordChangeDoneView.as_view(template_name=&apos;password_change_done.html&apos;),</span><br><span class="line">        name=&apos;password_change_done&apos;),</span><br><span class="line"></span><br><span class="line">    # 以下部分为页面路由</span><br><span class="line">    # 首页路由</span><br><span class="line">    # 调用views.home</span><br><span class="line">    path(&apos;&apos;, views.home, name=&apos;home&apos;),</span><br><span class="line">    # 分类课程信息路由</span><br><span class="line">    # 修改为当前主流的 path 适配方法</span><br><span class="line">    # 因为我们有4个分类 所以直接将 pk 传入到 view 视图 然后匹配得到一个分类的数据返回给页面</span><br><span class="line">    # 所有的分类都是同一个页面但是不同的数据渲染 这都是通过在 视图函数中实现的</span><br><span class="line">    # 后面的 &lt;int:pk&gt; 值是可变的 具体的用法后续可以看 view </span><br><span class="line">    path(&apos;boards/&lt;int:pk&gt;/&apos;,views.board_courses_2,name=&apos;board_courses_2&apos;),</span><br><span class="line">    # 跳转到数据可视化的页面 调用 data_analysis 的视图 name = &apos;data_analysis&apos; </span><br><span class="line">    # 这个 name 我们需要填写在 HTML 中  &lt;a href=&quot;&#123;% url &apos;data_analysis&apos;%&#125;&quot;&gt;Data Analysis&lt;/a&gt;</span><br><span class="line">    # 实现跳转效果</span><br><span class="line">    path(&apos;data_analysis/&apos;,views.data_analysis,name=&apos;data_analysis&apos;),</span><br><span class="line">]</span><br></pre></td></tr></table></figure></p>
<h2 id="Models"><a href="#Models" class="headerlink" title="Models"></a>Models</h2><p><strong>boards/models.py</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">from django.db import models</span><br><span class="line"># 我们不构建用户模型 直接继承 Django 内置模块</span><br><span class="line">from django.contrib.auth.models import User</span><br><span class="line"># Create your models here.</span><br><span class="line"></span><br><span class="line">&apos;&apos;&apos;</span><br><span class="line">为什么每个类都需要继承 models.Model </span><br><span class="line">因为所有的模型都是 django.db.models.Field 子类 </span><br><span class="line">这样每个类都被转换为数据库内的表</span><br><span class="line"></span><br><span class="line">每个字段由 django.db.models.Field子类的实例表示</span><br><span class="line">它们并将会被转换为数据库的列</span><br><span class="line">字段 CharField、DataTimeField等等</span><br><span class="line">都是 django.db.models.Filed的子类</span><br><span class="line"></span><br><span class="line">有些字段需要参数 例如 CharField </span><br><span class="line">我们应该设定一个 max_length 这些信息将用于创建数据库列 </span><br><span class="line">Django 需要知道数据库列需要多大</span><br><span class="line">该 max_length 参数也将被 Django Forms API 用来验证用户输入</span><br><span class="line"></span><br><span class="line">related_name 是可选项</span><br><span class="line">但是如果我们不为它设置一个名称</span><br><span class="line">Django会自动生成它：（class_name)_set</span><br><span class="line">如在 Board 模型中，所有的 Topic 列表将用 topic_set 属性表示</span><br><span class="line">如果设置 related_name =&apos;+&apos; </span><br><span class="line">指示 Django 我们不需要这种反向关系，所以它会被忽略</span><br><span class="line">也就是说我们不需要关系用户修改哪些帖子</span><br><span class="line">&apos;&apos;&apos;</span><br><span class="line"></span><br><span class="line"># 模块</span><br><span class="line">class Board(models.Model):</span><br><span class="line">    # unique= True 强调数据库级别字段的唯一性</span><br><span class="line">    # 必须添加 default 否则会报错告诉你必须添加默认值</span><br><span class="line">    name = models.CharField(max_length=30,unique=True,default=&apos;test&apos;)</span><br><span class="line">    description = models.CharField(max_length=100)</span><br><span class="line"></span><br><span class="line">    def __str__(self):</span><br><span class="line">        return self.name</span><br><span class="line"></span><br><span class="line"># 帖子</span><br><span class="line">class Courses(models.Model):</span><br><span class="line">    # 设置课程链接字段 长度为250 唯一主键 默认值为0</span><br><span class="line">    course_url = models.CharField(max_length=250,unique=True,default=&apos;0&apos;)</span><br><span class="line">    # 评价数</span><br><span class="line">    commitsnum = models.IntegerField()</span><br><span class="line">    # 课程名</span><br><span class="line">    coursename = models.CharField(max_length=50)</span><br><span class="line">    # 学习过人数</span><br><span class="line">    learnednums = models.IntegerField()</span><br><span class="line">    # 评分</span><br><span class="line">    score = models.FloatField()</span><br><span class="line">    # 教师名</span><br><span class="line">    teachername = models.CharField(max_length=10)</span><br><span class="line">    # 分类</span><br><span class="line">    direction = models.CharField(max_length=30)</span><br><span class="line">    # 图片路径 放在 static 下 默认值为空</span><br><span class="line">    imgpath = models.CharField(max_length=50,default=&apos;&apos;)</span><br><span class="line"></span><br><span class="line">    # Board 可以通过 related_name 参数用于创建反向关系</span><br><span class="line">    # 外键 可以通过外键来访问所属的上层分类和跟踪用户收藏信息</span><br><span class="line">    board =models.ForeignKey(Board,related_name=&apos;course&apos;,on_delete=models.CASCADE)</span><br><span class="line">    # 自定义字段 收藏 外键与课程相连接</span><br><span class="line">    # 跨 APP 构建外键 使用 to=&apos;app.models&apos;</span><br><span class="line">    # MantTOMany 是多对多 多用户对多课程信息</span><br><span class="line">    # related_name 是用来做反向查询的名字</span><br><span class="line">    # SET_NULL 意思是一个person删除了，其对应的所有books要删除</span><br><span class="line">    # 生成之后产生了一个中间表 表里有两个字段 一个是 courses_id 一个是 user_id</span><br><span class="line">    favorite = models.ManyToManyField(User, related_name=&apos;favorite&apos;)</span><br></pre></td></tr></table></figure></p>
<p>修改好 Model 之后，我们需要执行 <strong>python manage.py makemigrations</strong> 和 <strong>python manage.py migrate</strong></p>
<p>可以得到如下两个表</p>
<p><img src="18.png" alt></p>
<p>我们有四个分类，所以直接在数据库中插入了四个分类</p>
<p><img src="19.png" alt></p>
<h2 id="View"><a href="#View" class="headerlink" title="View"></a>View</h2><p><strong>boards/views.py</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"># 简单函数 为 django 的视图函数中返回浏览器响应的一些方法</span><br><span class="line"># render 返回渲染好的 HTMl 页面</span><br><span class="line"># get_object_or_404 如果请求的数据不再数据库 或者页面并不存在路由系统中则告诉用户页面丢失</span><br><span class="line"># redirect 重定向 不一定会用到</span><br><span class="line">from django.shortcuts import render,get_object_or_404,redirect</span><br><span class="line"># 导入 HttpResponse 对象 由 DJango 自动创建</span><br><span class="line">from django.http import HttpResponse,JsonResponse</span><br><span class="line"># 导入时间模块</span><br><span class="line">import datetime</span><br><span class="line"># 导入 Board 为数据调用做准备</span><br><span class="line">from .models import Board,Courses</span><br><span class="line"># 导入 Django 内置的用户组件</span><br><span class="line">from django.contrib.auth.models import  User</span><br><span class="line"></span><br><span class="line"># Create your views here.</span><br><span class="line"># 首页的视图函数</span><br><span class="line">def home(request):</span><br><span class="line">    boards = Board.objects.all()# 从数据库中读取 board 表内的数据 返回给首页进行列举</span><br><span class="line">    return render(request,&apos;home.html&apos;,&#123;&apos;boards&apos;:boards&#125;)</span><br><span class="line"></span><br><span class="line"># 课程信息页面</span><br><span class="line"># 应该是获取 courses 表的内容筛选后返回到给个表中</span><br><span class="line"># 但是我们还并没有将爬虫的数据进行一个入库操作 所以这里这样 后续在优化</span><br><span class="line">def board_courses_2(request,pk):</span><br><span class="line">    # 匹配 board 的 pk 值返回给 html 模板</span><br><span class="line">    # &#123;&#123;board.name&#125;&#125; - &#123;&#123;block.super&#125;&#125; 父类名称</span><br><span class="line">    # &#123;&#123; board.name &#125;&#125; 来获取当前分类的名字</span><br><span class="line">    board = get_object_or_404(Board,pk=pk)</span><br><span class="line">    return render(request, &apos;courses.html&apos;, &#123;&apos;board&apos;: board&#125;)</span><br><span class="line"></span><br><span class="line"># 可视化页面</span><br><span class="line">def data_analysis(request):</span><br><span class="line">    # 为了展示 Board  所以还是要返回一个board 对象</span><br><span class="line">    board = Board.objects.all()</span><br><span class="line">    # 主要是返回 course 的数据 方便拿来做可视化</span><br><span class="line">    courses = Courses.objects.all()</span><br><span class="line">    return render(request,&apos;Data_Analysis.html&apos;, &#123;&apos;board&apos;: board,&apos;courses&apos;:courses&#125;)</span><br></pre></td></tr></table></figure></p>
<h2 id="Teamplates"><a href="#Teamplates" class="headerlink" title="Teamplates"></a>Teamplates</h2><p>静态文本内容这里就不再列举了，你可以直接参考我的代码即可。</p>
<p>现在的页面如下</p>
<p><img src="20.png" alt></p>
<h1 id="Spyder"><a href="#Spyder" class="headerlink" title="Spyder"></a>Spyder</h1><p>爬虫部分的代码已经交付了，这里不再详细进行描述。主要是讲解数据迁移和标准化的详细过程。</p>
<h2 id="Data-migration"><a href="#Data-migration" class="headerlink" title="Data migration"></a>Data migration</h2><p>因为之前的数据我是直接存入到数据库表 <code>courseinfo</code></p>
<p><img src="21.png" alt></p>
<p>我们还没有下载课程的封面图片，而且数据也没有迁移 Django 的表中。我们首先对之前爬虫数据存入的表做一个查询，判断类别分别给类别赋值。与我们的 <code>boards</code> 的表相一致。<br>然后下载图片，存入到 <code>static\img\</code> 目录下，将图片名存入其中</p>
<p><strong>Data_migraton.py</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">&apos;&apos;&apos;&apos;</span><br><span class="line">将存储在数据表中的数据迁移到 Django 的表中</span><br><span class="line">- 需要将图片批量下载下来保存在 static\img 文件夹下 将文件名存在 Django 的 courses 表中</span><br><span class="line">- 将 direction 用字段 1 2 3 4 来替换 是为了匹配 view 穿回来的 pk 值</span><br><span class="line">- 更换完下载好图片之后，批量的转入 courses 表中</span><br><span class="line">&apos;&apos;&apos;</span><br><span class="line"></span><br><span class="line"># 请求图片的库</span><br><span class="line">import requests</span><br><span class="line"># 保存图片的库</span><br><span class="line">from PIL import Image</span><br><span class="line"># 操作路径的库</span><br><span class="line">from io import BytesIO</span><br><span class="line"># 引入时间 方便休眠</span><br><span class="line">import time</span><br><span class="line"># 执行数据库的第三方库</span><br><span class="line">import pymysql</span><br><span class="line">db = pymysql.connect(host=&apos;127.0.0.1&apos;,</span><br><span class="line">                     port=3306,</span><br><span class="line">                     user=&apos;root&apos;,</span><br><span class="line">                     password=&apos;password&apos;,</span><br><span class="line">                     db=&apos;bishe&apos;,</span><br><span class="line">                     charset=&apos;utf8&apos;)</span><br><span class="line">cursor = db.cursor()</span><br><span class="line"># 查询</span><br><span class="line">try:</span><br><span class="line">    sql_1 = &apos;select * from courseinfo&apos;</span><br><span class="line">    cursor.execute(sql_1) # 执行查询</span><br><span class="line">    # 列表化</span><br><span class="line">    contents = cursor.fetchall()</span><br><span class="line">    # 遍历数据</span><br><span class="line">    id=1</span><br><span class="line">    for content in contents:</span><br><span class="line">        print(content[0])</span><br><span class="line">        print(content[1])</span><br><span class="line">        print(content[2]) # 图片链接</span><br><span class="line">        print(content[3])</span><br><span class="line">        renshu = content[4].replace(&apos;人参加&apos;, &apos;&apos;)</span><br><span class="line">        print(renshu)</span><br><span class="line">        print(content[5])</span><br><span class="line">        print(content[6])</span><br><span class="line">        if content[7] ==&apos;python&apos;:</span><br><span class="line">            direction =2</span><br><span class="line">        elif content[7] ==&apos;java&apos;:</span><br><span class="line">            direction = 1</span><br><span class="line">        elif content[7] ==&apos;网络安全&apos;:</span><br><span class="line">            direction = 3</span><br><span class="line">        else:</span><br><span class="line">            direction= 4</span><br><span class="line">        print(direction)  # 分类</span><br><span class="line">        print(&apos;---------------------\n&apos;)</span><br><span class="line">        # 请求图片</span><br><span class="line">        html = requests.get(content[2])</span><br><span class="line">        # 拼接成图片名字</span><br><span class="line">        img_name = str(id) + &apos;.png&apos;</span><br><span class="line">        # 打开空间方便后面写入图片内容</span><br><span class="line">        image = Image.open(BytesIO(html.content))</span><br><span class="line">        # 插入 Django 的数据表 boards_courses 内</span><br><span class="line">        sql_2 = &quot;&quot;&quot;</span><br><span class="line">            INSERT IGNORE INTO boards_courses (id,course_url,commitsnum,imgpath,coursename,learnednums,score,teachername,direction,board_id)VALUES(&apos;&#123;&#125;&apos;,&apos;&#123;&#125;&apos;,&apos;&#123;&#125;&apos;,&apos;&#123;&#125;&apos;,&apos;&#123;&#125;&apos;,&apos;&#123;&#125;&apos;,&apos;&#123;&#125;&apos;,&apos;&#123;&#125;&apos;,&apos;&#123;&#125;&apos;,&apos;&#123;&#125;&apos;  )</span><br><span class="line">        &quot;&quot;&quot;.format(</span><br><span class="line">            id,</span><br><span class="line">            content[0],</span><br><span class="line">            content[1],</span><br><span class="line">            img_name,</span><br><span class="line">            content[3],</span><br><span class="line">            content[4],</span><br><span class="line">            content[5],</span><br><span class="line">            content[6],</span><br><span class="line">            direction,</span><br><span class="line">            direction,</span><br><span class="line">        )</span><br><span class="line">        cursor.execute(sql_2)  # 执行语句</span><br><span class="line">        db.commit()  # 提交事务</span><br><span class="line">        # 将图片内容存储下来</span><br><span class="line">        image.save(&apos;static/img&apos; + &quot;/&quot; + img_name)</span><br><span class="line">        print(&apos;第%d张图片下载完成&apos; % (id))</span><br><span class="line">        time.sleep(1)  # 自定义延时</span><br><span class="line">        id += 1</span><br><span class="line">except:</span><br><span class="line">    print(&apos;查询失败&apos;)</span><br></pre></td></tr></table></figure>
<p>得到结果如下</p>
<p><img src="22.png" alt></p>
<p><img src="23.png" alt></p>
<h1 id="Course-List"><a href="#Course-List" class="headerlink" title="Course List"></a>Course List</h1><p>数据既然已经入库了，那么我们现在的操作就是如何将数据在数据库中分类查询然后展示在前端上。这里主要是使用外键来作用的。我们在路由中已经将 <strong>Board</strong> 的 <strong>PK</strong> 值传给了 <strong>View</strong> 函数，使用外键的方向作用即可获取到关联数据。</p>
<p><strong>boards/views.py</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># 课程信息页面</span><br><span class="line"># 应该是获取 courses 表的内容筛选后返回到给个表中</span><br><span class="line"># 但是我们还并没有将爬虫的数据进行一个入库操作 所以这里这样 后续在优化</span><br><span class="line">def board_courses_2(request,pk):</span><br><span class="line">    # 匹配 board 的 pk 值返回给 html 模板</span><br><span class="line">    # &#123;&#123;board.name&#125;&#125; - &#123;&#123;block.super&#125;&#125; 父类名称</span><br><span class="line">    # &#123;&#123; board.name &#125;&#125; 来获取当前分类的名字</span><br><span class="line">    board = get_object_or_404(Board,pk=pk)</span><br><span class="line">    # 通过外链来获取数据查看是否能够查询到数据</span><br><span class="line">    # course 是我们在 models 中定义外键时定义的 name </span><br><span class="line">    # board =models.ForeignKey(Board,related_name=&apos;course&apos;,on_delete=models.CASCADE)</span><br><span class="line">    course = board.course.all()</span><br><span class="line">    print(course)</span><br><span class="line">    return render(request, &apos;courses.html&apos;, &#123;&apos;board&apos;: board&#125;)</span><br></pre></td></tr></table></figure>
<p>因为我们传给前端页面的 <strong>Model</strong> 是 <strong>board</strong> ,所以只能使用外键来进行，当然我们也可以使用函数来操作。</p>
<p><strong>templates/courses.html</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#...</span><br><span class="line"># 获取所有的 board.pk 是 pk 的关联课程的信息</span><br><span class="line">&lt;tbody&gt;</span><br><span class="line">    &#123;% for course in board.course.all %&#125;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            # 插入图片 设定高度和宽度</span><br><span class="line">            &lt;td&gt;&lt;img src=&quot;/static/img/&#123;&#123; course.imgpath &#125;&#125;&quot; height=&quot;135&quot; width=&quot;240&quot;&gt;&lt;/td&gt;</span><br><span class="line">            # 插入名字 名字用a标签包裹 然后可以直接跳转到课程首页</span><br><span class="line">            &lt;td&gt;&lt;a href=&quot;&#123;&#123; course.course_url &#125;&#125;&quot;&gt;&#123;&#123; course.coursename &#125;&#125;&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">            # 授课老师名字</span><br><span class="line">            &lt;td&gt;&#123;&#123; course.teachername &#125;&#125;&lt;/td&gt;</span><br><span class="line">            # 学习过的人数名</span><br><span class="line">            &lt;td&gt;&#123;&#123; course.learnednums&#125;&#125;&lt;/td&gt;</span><br><span class="line">            # 评分</span><br><span class="line">            &lt;td&gt;&#123;&#123; course.score &#125;&#125;&lt;/td&gt;</span><br><span class="line">            # 评论数</span><br><span class="line">            &lt;td&gt;&#123;&#123; course.commitsnum &#125;&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;收藏按钮&lt;/td&gt;</span><br><span class="line"></span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line">&lt;/tbody&gt;</span><br></pre></td></tr></table></figure></p>
<p>效果如下</p>
<p><img src="25.png" alt></p>
<h2 id="根据评分、学习人数排序"><a href="#根据评分、学习人数排序" class="headerlink" title="根据评分、学习人数排序"></a>根据评分、学习人数排序</h2><p>设置一个新的路由，方便调用我们筛选后的数据在页面上进行展示。我们仍然是使用之前 HTML 模板。只是数据的排序方式随着传入参数的不同而改变。</p>
<p><strong>myproject/urls.py</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path(&apos;boards/&lt;int:pk&gt;/&lt;str:order_style&gt;/&apos;,views.board_courses_list,name=&apos;order_style&apos;),</span><br></pre></td></tr></table></figure></p>
<p><strong>boards/views.py</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"># 传入三个值 request请求 board.pk 和 排序方法</span><br><span class="line">def board_courses_list(request,pk,order_style):</span><br><span class="line">    # 匹配 board 的 pk 值返回给 html 模板</span><br><span class="line">    # &#123;&#123;board.name&#125;&#125; - &#123;&#123;block.super&#125;&#125; 父类名称</span><br><span class="line">    # &#123;&#123; board.name &#125;&#125; 来获取当前分类的名字</span><br><span class="line">    board = get_object_or_404(Board,pk=pk)</span><br><span class="line">    # 通过外链来获取数据查看是否能够查询到数据</span><br><span class="line">    course = board.course.all()</span><br><span class="line"></span><br><span class="line">    # 两个排序关键词</span><br><span class="line">    # - 表示降序 order_by 根据关键词排序</span><br><span class="line">    if order_style ==&apos;score&apos;:</span><br><span class="line">        order_style =&apos;-score&apos;</span><br><span class="line">    else:</span><br><span class="line">        order_style =&apos;-learnednums&apos;</span><br><span class="line">    # 有两个按钮如果存在的话就进行搜索排序</span><br><span class="line">    if order_style :</span><br><span class="line">        course_list = course.order_by(order_style)</span><br><span class="line">    else:</span><br><span class="line">        course_list = course</span><br><span class="line">    print(course_list)</span><br><span class="line">    return render(request, &apos;courses.html&apos;, &#123;&apos;board&apos;: board,&apos;course_list&apos;:course_list&#125;)</span><br></pre></td></tr></table></figure>
<p><strong>templates/courses.html</strong></p>
<p>这里为什么有一个判断呢？因为我们筛选后的数据是以 course_list 字典的形式传给 HTML，但是我们默认的数据是没有排序的，所以只能用 <code>for course in board.course.all</code> ，我们需要进行判断是否有进行筛选，没有的话就直接查询就行。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&#123;% if  course_list %&#125;</span><br><span class="line">    &#123;% for course in course_list %&#125;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line"></span><br><span class="line">            &lt;td&gt;&lt;img src=&quot;/static/img/&#123;&#123; course.imgpath &#125;&#125;&quot; height=&quot;135&quot; width=&quot;240&quot;&gt;&lt;/td&gt;</span><br><span class="line"></span><br><span class="line">            &lt;td&gt;&lt;a href=&quot;&#123;&#123; course.course_url &#125;&#125;&quot;&gt;&#123;&#123; course.coursename &#125;&#125;&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;&#123;&#123; course.teachername &#125;&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;&#123;&#123; course.learnednums&#125;&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;&#123;&#123; course.score &#125;&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;&#123;&#123; course.commitsnum &#125;&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;&#123;&#123; course.source &#125;&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;收藏按钮&lt;/td&gt;</span><br><span class="line"></span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line">&#123;% else %&#125;</span><br><span class="line">    &#123;% for course in board.course.all %&#125;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;&lt;img src=&quot;/static/img/&#123;&#123; course.imgpath &#125;&#125;&quot; height=&quot;135&quot; width=&quot;240&quot;&gt;&lt;/td&gt;</span><br><span class="line"></span><br><span class="line">            &lt;td&gt;&lt;a href=&quot;&#123;&#123; course.course_url &#125;&#125;&quot;&gt;&#123;&#123; course.coursename &#125;&#125;&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;&#123;&#123; course.teachername &#125;&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;&#123;&#123; course.learnednums&#125;&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;&#123;&#123; course.score &#125;&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;&#123;&#123; course.commitsnum &#125;&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;&#123;&#123; course.source &#125;&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;收藏按钮&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure>
<p><img src="26.png" alt></p>
<p>但是，我们需要将前面的跳转链接进行优化，去掉重复的 <strong>URL</strong>  和 <strong>View</strong> 。这里跳转传入的值是 id ，但是其实这个值并没有发挥作用，因为我们在 <strong>View</strong> 中并没有采取这个字段。但是默认的排序就是根据 id 来排序的。 需要注意跳转链接需要传入两个值，下面就是我们在 HTML 模板中修改的后面传入的值</p>
<p><strong>templates/courses.html</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;li class=&quot;breadcrumb-item active&quot;&gt;&lt;a href=&quot;&#123;% url &apos;order_style&apos; board.pk &apos;id&apos;%&#125;&quot;&gt;&#123;&#123; board.name &#125;&#125;&lt;/a&gt;&lt;/li&gt;</span><br></pre></td></tr></table></figure></p>
<p><strong>templates/home.html</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href=&quot;&#123;% url &apos;order_style&apos; board.pk &apos;id&apos;%&#125;&quot;&gt;&#123;&#123; board.name &#125;&#125;&lt;/a&gt;</span><br></pre></td></tr></table></figure></p>
<p><strong>myproject/urls.py</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"># 后台管理模块</span><br><span class="line">from django.contrib import admin</span><br><span class="line"># 路由匹配模块</span><br><span class="line">from django.urls import path,re_path</span><br><span class="line"># 注册路由模块</span><br><span class="line">from django.contrib.auth import views as auth_views</span><br><span class="line"># 从两个 app 中引入视图函数</span><br><span class="line">from boards import views</span><br><span class="line"># 做一个重命名 避免产生冲突</span><br><span class="line">from accounts import views as accounts_views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    # 以下部分全部是用户部分的路由</span><br><span class="line">    path(&apos;admin/&apos;, admin.site.urls),</span><br><span class="line">    # 注册</span><br><span class="line">    path(&apos;signup/&apos;,accounts_views.signup,name=&apos;signup&apos;),</span><br><span class="line">    # 登出</span><br><span class="line">    path(&apos;logout/&apos;, auth_views.LogoutView.as_view(), name=&apos;logout&apos;),</span><br><span class="line">    # 登录</span><br><span class="line">    path(&apos;login/&apos;,auth_views.LoginView.as_view(template_name=&apos;login.html&apos;), name=&apos;login&apos;),</span><br><span class="line">    # 重置密码</span><br><span class="line">    path(&apos;reset/&apos;,</span><br><span class="line">        auth_views.PasswordResetView.as_view(</span><br><span class="line">            template_name=&apos;password_reset.html&apos;,</span><br><span class="line">            email_template_name=&apos;password_reset_email.html&apos;,</span><br><span class="line">            subject_template_name=&apos;password_reset_subject.txt&apos;</span><br><span class="line">        ),name=&apos;password_reset&apos;),</span><br><span class="line">    # 重置成功界面</span><br><span class="line">    path(&apos;reset/done/&apos;,</span><br><span class="line">        auth_views.PasswordResetDoneView.as_view(template_name=&apos;password_reset_done.html&apos;),</span><br><span class="line">        name=&apos;password_reset_done&apos;),</span><br><span class="line">    # 重置链接路由 我们采用 re_path 的匹配方法来进行</span><br><span class="line">    re_path(&apos;^reset/(?P&lt;uidb64&gt;[0-9A-Za-z_\-]+)/(?P&lt;token&gt;[0-9A-Za-z]&#123;1,13&#125;-[0-9A-Za-z]&#123;1,20&#125;)/$&apos;,</span><br><span class="line">        auth_views.PasswordResetConfirmView.as_view(template_name=&apos;password_reset_confirm.html&apos;),</span><br><span class="line">        name=&apos;password_reset_confirm&apos;),</span><br><span class="line">    # 重置密码成功界面</span><br><span class="line">    path(&apos;reset/complete/&apos;,</span><br><span class="line">        auth_views.PasswordResetCompleteView.as_view(template_name=&apos;password_reset_complete.html&apos;),</span><br><span class="line">        name=&apos;password_reset_complete&apos;),</span><br><span class="line"></span><br><span class="line">    # 修改密码界面</span><br><span class="line">    path(r&apos;settings/password/&apos;, auth_views.PasswordChangeView.as_view(template_name=&apos;password_change.html&apos;),</span><br><span class="line">        name=&apos;password_change&apos;),</span><br><span class="line">    # 修改密码成功界面</span><br><span class="line">    path(r&apos;settings/password/done/&apos;, auth_views.PasswordChangeDoneView.as_view(template_name=&apos;password_change_done.html&apos;),</span><br><span class="line">        name=&apos;password_change_done&apos;),</span><br><span class="line"></span><br><span class="line">    # 以下部分为页面路由</span><br><span class="line">    # 首页路由</span><br><span class="line">    # 调用views.home</span><br><span class="line">    path(&apos;&apos;, views.home, name=&apos;home&apos;),</span><br><span class="line">    # 分类课程信息路由</span><br><span class="line">    # 修改为当前主流的 path 适配方法</span><br><span class="line">    # 筛选 </span><br><span class="line">    path(&apos;boards/&lt;int:pk&gt;/&lt;str:order_style&gt;/&apos;,views.board_courses_list,name=&apos;order_style&apos;),</span><br><span class="line">    # 可视化页面</span><br><span class="line">    path(&apos;data_analysis/&apos;,views.data_analysis,name=&apos;data_analysis&apos;),</span><br><span class="line">    # 个人信息页面</span><br><span class="line">    path(&apos;my_account/&apos;,views.myaccount,name=&apos;myaccount&apos;)</span><br><span class="line">]</span><br></pre></td></tr></table></figure></p>
<p><strong>boards/views.py</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"># 简单函数 为 django 的视图函数中返回浏览器响应的一些方法</span><br><span class="line"># render 返回渲染好的 HTMl 页面</span><br><span class="line"># get_object_or_404 如果请求的数据不再数据库 或者页面并不存在路由系统中则告诉用户页面丢失</span><br><span class="line"># redirect 重定向 不一定会用到</span><br><span class="line">from django.shortcuts import render,get_object_or_404,redirect</span><br><span class="line"># 导入 HttpResponse 对象 由 DJango 自动创建</span><br><span class="line">from django.http import HttpResponse,JsonResponse</span><br><span class="line"># 导入时间模块</span><br><span class="line">import datetime</span><br><span class="line"># 导入 Board 为数据调用做准备</span><br><span class="line">from .models import Board,Courses</span><br><span class="line"># 导入 Django 内置的用户组件</span><br><span class="line">from django.contrib.auth.models import  User</span><br><span class="line"></span><br><span class="line"># Create your views here.</span><br><span class="line"># 首页的视图函数</span><br><span class="line">def home(request):</span><br><span class="line">    boards = Board.objects.all()# 从数据库中读取 board 表内的数据 返回给首页进行列举</span><br><span class="line">    return render(request,&apos;home.html&apos;,&#123;&apos;boards&apos;:boards&#125;)</span><br><span class="line"></span><br><span class="line"># 课程信息页面</span><br><span class="line"># 排序</span><br><span class="line">def board_courses_list(request,pk,order_style):</span><br><span class="line">    # 匹配 board 的 pk 值返回给 html 模板</span><br><span class="line">    # &#123;&#123;board.name&#125;&#125; - &#123;&#123;block.super&#125;&#125; 父类名称</span><br><span class="line">    # &#123;&#123; board.name &#125;&#125; 来获取当前分类的名字</span><br><span class="line">    board = get_object_or_404(Board,pk=pk)</span><br><span class="line">    # 通过外链来获取数据查看是否能够查询到数据</span><br><span class="line">    course = board.course.all()</span><br><span class="line"></span><br><span class="line">    # 两个排序关键词</span><br><span class="line">    if order_style ==&apos;score&apos;:</span><br><span class="line">        order_style =&apos;-score&apos;</span><br><span class="line">    else:</span><br><span class="line">        order_style =&apos;-learnednums&apos;</span><br><span class="line">    # 有两个按钮如果存在的话就进行搜索排序</span><br><span class="line">    if order_style :</span><br><span class="line">        # - 表示降序 order_by 根据关键词排序</span><br><span class="line">        course_list = course.order_by(order_style)</span><br><span class="line">    else:</span><br><span class="line">        course_list = course</span><br><span class="line">    print(course_list)</span><br><span class="line">    return render(request, &apos;courses.html&apos;, &#123;&apos;board&apos;: board,&apos;course_list&apos;:course_list&#125;)</span><br><span class="line"></span><br><span class="line"># 可视化页面</span><br><span class="line">def data_analysis(request):</span><br><span class="line">    # 为了展示 Board  所以还是要返回一个board 对象</span><br><span class="line">    board = Board.objects.all()</span><br><span class="line">    # 主要是返回 course 的数据 方便拿来做可视化</span><br><span class="line">    courses = Courses.objects.all()</span><br><span class="line">    return render(request,&apos;Data_Analysis.html&apos;, &#123;&apos;board&apos;: board,&apos;courses&apos;:courses&#125;)</span><br><span class="line"></span><br><span class="line"># 个人信息页面 可以查看收藏的课程</span><br><span class="line">def myaccount(request):</span><br><span class="line">    return render(request,&apos;My_account.html&apos;)</span><br></pre></td></tr></table></figure>
<p>对比之前的路由和视图，你就会发现我们将一些重复的内容去掉了。</p>
<h2 id="收藏功能"><a href="#收藏功能" class="headerlink" title="收藏功能"></a>收藏功能</h2><p>想要实现收藏功能，首先是处理 Model 关系，其次是使用什么 View 方法来传递用户收藏的操作，最后是在前端实现一个收藏与未收藏展示效果的切换。</p>
<h3 id="ManyToMany"><a href="#ManyToMany" class="headerlink" title="ManyToMany"></a>ManyToMany</h3><p>许多个用户可以收藏许多个课程，所以是多对多的关系。我们在 <code>boards/models.py</code> 中添加一个多对多的外键 <code>favorite = models.ManyToManyField(User, related_name=&#39;favorite&#39;)</code> 因为我们不需要额外的键所以最简单的全自动方法就可以了，然后执行数据迁移</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">manage.py@myproject &gt; makemigrations</span><br><span class="line">Tracking file by folder pattern:  migrations</span><br><span class="line">Migrations for &apos;boards&apos;:</span><br><span class="line">  boards\migrations\0003_auto_20200327_2037.py</span><br><span class="line">    - Remove field starter from courses</span><br><span class="line">    - Add field favorite to courses</span><br><span class="line">manage.py@myproject &gt; migrate</span><br><span class="line">Tracking file by folder pattern:  migrations</span><br><span class="line">Operations to perform:</span><br><span class="line">  Apply all migrations: admin, auth, boards, contenttypes, sessions</span><br><span class="line">Running migrations:</span><br><span class="line">  Applying boards.0003_auto_20200327_2037... OK</span><br></pre></td></tr></table></figure>
<p>然后我们在数据库中就可以得到一个如下内容的表</p>
<p><img src="24.png" alt></p>
<p>我们先在 Python shell 中进行一个测试，了解多对多数据的添加和查询<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">(base) Django-Mooc&gt;python manage.py shell</span><br><span class="line">Python 3.7.1 (default, Dec 10 2018, 22:54:23) [MSC v.1915 64 bit (AMD64)]</span><br><span class="line">Type &apos;copyright&apos;, &apos;credits&apos; or &apos;license&apos; for more information</span><br><span class="line">IPython 7.2.0 -- An enhanced Interactive Python. Type &apos;?&apos; for help.</span><br><span class="line"></span><br><span class="line"># 导入数据模型</span><br><span class="line">In [1]: from django.contrib.auth.models import User</span><br><span class="line">In [2]: from boards.models import Board,Courses</span><br><span class="line"></span><br><span class="line"># 查询所有的课程表内的信息</span><br><span class="line">In [3]: courses = Courses.objects.all()</span><br><span class="line"># 查询第一条课程信息</span><br><span class="line">In [5]: courses[0]</span><br><span class="line">Out[5]: &lt;Courses: Courses object (1)&gt;</span><br><span class="line">In [6]: courses[0].coursename</span><br><span class="line">Out[6]: &apos;单片机原理及接口技术&apos;</span><br><span class="line">In [7]: courses[0].id</span><br><span class="line">Out[7]: 1</span><br><span class="line"></span><br><span class="line"># 查询用户信息</span><br><span class="line">In [8]: user = User.objects.all()</span><br><span class="line">In [9]: user[0]</span><br><span class="line">Out[9]: &lt;User: afrunk&gt;</span><br><span class="line"></span><br><span class="line"># 反向添加方式</span><br><span class="line"># 注意我们当时构建外键的主体是 Courses Model 中执行的语句</span><br><span class="line"># 但是我们现在会用到的都是反向查询 即从用户方向来查询收藏的课程信息</span><br><span class="line"># 添加也是如此 user[0] 表示某个用户 我们在 view 中可以用 this.user 来表示</span><br><span class="line"># favorite 是我们构建外键的 related_name </span><br><span class="line"># favorite = models.ManyToManyField(User, related_name=&apos;favorite&apos;)</span><br><span class="line"></span><br><span class="line"># 添加的课程信息方法 可以传入对象 也可以传入课程的 pk 值</span><br><span class="line">In [10]: user[0].favorite.add(courses[0])</span><br><span class="line">In [18]: user[0].favorite.add(courses[1].id)</span><br><span class="line"></span><br><span class="line"># 反向查询多对多表的信息</span><br><span class="line">In [11]: contents = user[0].favorite.all()</span><br><span class="line">In [12]: contents</span><br><span class="line">Out[12]: &lt;QuerySet [&lt;Courses: Courses object (1)&gt;]&gt;</span><br><span class="line"></span><br><span class="line"># 查询关联的具体信息</span><br><span class="line">In [13]: contents[0].coursename</span><br><span class="line">Out[13]: &apos;单片机原理及接口技术&apos;</span><br><span class="line"></span><br><span class="line"># 删除部分</span><br><span class="line">(base) Django-Mooc&gt;python manage.py shell</span><br><span class="line">Python 3.7.1 (default, Dec 10 2018, 22:54:23) [MSC v.1915 64 bit (AMD64)]</span><br><span class="line">Type &apos;copyright&apos;, &apos;credits&apos; or &apos;license&apos; for more information</span><br><span class="line">IPython 7.2.0 -- An enhanced Interactive Python. Type &apos;?&apos; for help.</span><br><span class="line"></span><br><span class="line">In [1]: from django.contrib.auth.models import User</span><br><span class="line"></span><br><span class="line">In [2]: from boards.models import Board,Courses</span><br><span class="line"></span><br><span class="line">In [3]: a = User.objects.get(id=1)</span><br><span class="line"></span><br><span class="line">In [4]: a</span><br><span class="line">Out[4]: &lt;User: afrunk&gt;</span><br><span class="line"></span><br><span class="line">In [5]: b = Courses.objects.get(id=2)</span><br><span class="line"></span><br><span class="line">In [6]: b</span><br><span class="line">Out[6]: &lt;Courses: Courses object (2)&gt;</span><br><span class="line"></span><br><span class="line">In [7]: b.favorite.add(a)</span><br><span class="line"></span><br><span class="line">In [8]: b = Courses.objects.get(id=3)</span><br><span class="line"></span><br><span class="line">In [9]: b.favorite.add(a)</span><br><span class="line"></span><br><span class="line">In [10]: b.favorite.remove(a)</span><br><span class="line"></span><br><span class="line">In [11]: a.favorite.add(b)</span><br><span class="line"></span><br><span class="line">In [12]: a.favorite.remove(b)</span><br></pre></td></tr></table></figure></p>
<p>刚刚我们执行的添加语句在表中添加的多对多关系</p>
<p><img src="27.png" alt></p>
<p>了解了如何添加和查询多对多的数据模型，还需要知道如何通过 Ajax 来异步执行收藏效果。</p>
<h3 id="Ajax-异步查询传递数据"><a href="#Ajax-异步查询传递数据" class="headerlink" title="Ajax 异步查询传递数据"></a>Ajax 异步查询传递数据</h3><p>了解收藏 <strong>Model</strong> 的构成，我们需要如何实现这个操作呢？为了使得操作流畅，一般都是使用 Ajax，了解 Ajax 是如何工作的就是下一步开发的前提。</p>
<p><strong>Ajax</strong> (Asynchronous Javascript And XML) 是异步 JavaScript 和  XML。即使用 JavaScript 语言和服务器进行异步交互，传输的方式为 XMl（当然现在更多的是 Json 数据）。</p>
<ul>
<li>同步交互：客户端发出一个请求后，需要等待服务器响应结束后，才能发出第二个请求</li>
<li>异步交互：客户端发出一个请求后，无需等待服务器响应，就可以发出第二个请求</li>
</ul>
<p>但是 Ajax 在本文中的最大用处是 <strong>浏览器局部页面刷新</strong>。</p>
<p>下面，我们在页面中进行一个求和的尝试，帮助你理解 Ajax 与 Django 的配合开发是什么流程。</p>
<p>首先是引入 <strong>JQuery</strong> 的 js 支持，<code>&lt;script src=&quot;/static/js/jquery-3.2.1.min.js&quot;&gt;&lt;/script&gt;</code>,将我们下载好的 <code>JQuery</code> 文件在 <code>HTML</code> 文件中引入。</p>
<p>在 <strong>templates/courses.html</strong> 页面中加入如下代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=&quot;text&quot; id=&quot;i1&quot;&gt;+</span><br><span class="line">&lt;input type=&quot;text&quot; id=&quot;i2&quot;&gt;=</span><br><span class="line">&lt;input type=&quot;text&quot; id=&quot;i3&quot;&gt;</span><br><span class="line">&lt;input type=&quot;button&quot; value=&quot;AJAX提交&quot; id=&quot;b1&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;script src=&quot;/static/js/jquery-3.2.1.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    # 点击 id=b1 的按钮执行 ajax 响应</span><br><span class="line">    $(&quot;#b1&quot;).on(&quot;click&quot;, function () &#123;</span><br><span class="line">        $.ajax(&#123;</span><br><span class="line">            # 绑定路由 ajax_add 然后通过路由绑定视图 返回 function(data) 里的data</span><br><span class="line">            # 这里的 ajax_add 会附在 HTML 文件的路由后 所以我们在配置 ajax 的视图函数时需要将 HTML 的视图函数的参数都加上 </span><br><span class="line">            url: &quot;ajax_add&quot;,</span><br><span class="line">            type: &quot;POST&quot;,</span><br><span class="line">            # data 为传入视图函数中的值 不需要在视图的参数中进行添加</span><br><span class="line">            data: &#123;&quot;i1&quot;: $(&quot;#i1&quot;).val(), &quot;i2&quot;: $(&quot;#i2&quot;).val()&#125;,</span><br><span class="line">            success: function (data) &#123;</span><br><span class="line">                # 将响应的值 填入到 id = i3 的框内</span><br><span class="line">                $(&quot;#i3&quot;).val(data);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></p>
<p>效果如下，具体代码解析看注释：</p>
<p><img src="28.png" alt></p>
<p>然后是添加路由 <strong>myproject/urls.py</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#...</span><br><span class="line">path(&apos;boards/&lt;int:pk&gt;/&lt;str:order_style&gt;/ajax_add&apos;,views.ajax_add,name=&apos;ajax_add&apos;),</span><br></pre></td></tr></table></figure></p>
<p>需要注意我们的 <strong>HTML</strong> 文件的 路由后加上在 <strong>HTML</strong> 文件中写入的 <strong>ajax_add</strong> 才能实现响应。</p>
<p>然后是绑定该路由的视图函数 <strong>boards/views.py</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">def ajax_add(request,pk,order_style):</span><br><span class="line">    # 获取 HTML 的 ajax 返回的值</span><br><span class="line">    num1 = request.POST.get(&quot;i1&quot;)</span><br><span class="line">    num2 = request.POST.get(&quot;i2&quot;)</span><br><span class="line">    # 进行求和操作</span><br><span class="line">    ret = int(num1) + int(num2)</span><br><span class="line">    # 返回给 Ajax 请求</span><br><span class="line">    return HttpResponse(ret)</span><br></pre></td></tr></table></figure>
<p><img src="28.png" alt></p>
<p>我们在前端输入 2 和 3 点击 Ajax提交之后就可以得到一个结果 5,这就是最简单的 Ajax 交互。</p>
<p>了解了 Ajax 的操作流程，我们来继续开发收藏效果<br><strong>myproject/urls.py</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path(&apos;add_favorite&apos;,views.add_favorite,name=&apos;add_favorite&apos;),</span><br></pre></td></tr></table></figure>
<p><strong>boards/views.py</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"># 收藏</span><br><span class="line"># 参数是由所在 HTML 页面的路由决定的</span><br><span class="line">def add_favorite(request):</span><br><span class="line">    # 定义收藏用户</span><br><span class="line">    user = request.user</span><br><span class="line">    # Ajax 传回来课程 id</span><br><span class="line">    course_id = request.POST.get(&apos;course_id&apos;)</span><br><span class="line">    # 查询所有的收藏课程信息</span><br><span class="line">    like_courses = user.favorite.all()</span><br><span class="line"></span><br><span class="line">    # 遍历查询如果查到最后都没有匹配的id则表示未收藏进行收藏操作</span><br><span class="line">    # 如果已收藏 但是点击了 则进行删除操作</span><br><span class="line">    for i in like_courses:</span><br><span class="line">        if i.id == int(course_id):</span><br><span class="line">            print(&apos;已收藏&apos;+str(i.pk))</span><br><span class="line">            # 如果存在收藏列表则删除</span><br><span class="line">            # 定义课程</span><br><span class="line">            course = Courses.objects.get(id=course_id)</span><br><span class="line">            # 课程.favorite.remove(用户)</span><br><span class="line">            course.favorite.remove(user)</span><br><span class="line">            return HttpResponse(&#123;&apos;love_state&apos;: &apos;1&apos;&#125;)</span><br><span class="line">    else:</span><br><span class="line">        pass</span><br><span class="line">    # 未收藏则进行收藏操作</span><br><span class="line">    # 用户.favorite.add(课程）</span><br><span class="line">    user.favorite.add(course_id)</span><br><span class="line">    return HttpResponse(&#123;&apos;love_state&apos;: &apos;1&apos;&#125;)</span><br></pre></td></tr></table></figure>
<p><strong>templates/courses.html</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&#123;% if  course_list %&#125;</span><br><span class="line">    # 课程列表</span><br><span class="line">    &#123;% for course in course_list %&#125;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line"></span><br><span class="line">            &lt;td&gt;&lt;img src=&quot;/static/img/&#123;&#123; course.imgpath &#125;&#125;&quot; height=&quot;135&quot; width=&quot;240&quot;&gt;&lt;/td&gt;</span><br><span class="line"></span><br><span class="line">            &lt;td&gt;&lt;a href=&quot;&#123;&#123; course.course_url &#125;&#125;&quot;&gt;&#123;&#123; course.coursename &#125;&#125;&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;&#123;&#123; course.teachername &#125;&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;&#123;&#123; course.learnednums&#125;&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;&#123;&#123; course.score &#125;&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;&#123;&#123; course.commitsnum &#125;&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;&#123;&#123; course.source &#125;&#125;&lt;/td&gt;</span><br><span class="line">            # 收藏列表</span><br><span class="line">            &#123;% if course in like_courses  %&#125;</span><br><span class="line">    &#123;#                        判断是否在收藏课程中 如果在的话就可以点击#&#125;</span><br><span class="line">            &lt;td&gt;&lt;button id=&quot;&#123;&#123; course.id &#125;&#125;&quot;&gt;收藏成功&lt;/button&gt;&lt;/td&gt;</span><br><span class="line">            &#123;% else %&#125;</span><br><span class="line">            &lt;td&gt;&lt;button id=&quot;&#123;&#123; course.id &#125;&#125;&quot;&gt;收藏&lt;/button&gt;&lt;/td&gt;</span><br><span class="line">            &#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        # ajax 脚本</span><br><span class="line">        # 关键是传送的 course.id 否则的话无法进行定位元素</span><br><span class="line">        # 这也是为什么将 script 放在 for 循环里的原因</span><br><span class="line">        &lt;script src=&quot;/static/js/jquery-3.2.1.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">        &lt;script&gt;</span><br><span class="line">            $(&quot;#&#123;&#123; course.id &#125;&#125;&quot;).on(&quot;click&quot;, function () &#123;</span><br><span class="line">                var course_id = &#123;&#123; course.id &#125;&#125;</span><br><span class="line">                $.ajax(&#123;</span><br><span class="line">                    &lt;!-- 这个绝对路由决定了视图函数在任何位置都可以起作用 --&gt;</span><br><span class="line">                    url: &quot;http://127.0.0.1:8000/add_favorite&quot;,</span><br><span class="line">                    type: &quot;POST&quot;,</span><br><span class="line">                    data: &#123;&quot;course_id&quot;: course_id &#125;,</span><br><span class="line">                    success: function (data) &#123;</span><br><span class="line">    &#123;#                                &#123;&#123;love_sate &#125;&#125; = data.love_state#&#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;);</span><br><span class="line">        &lt;/script&gt;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>
<p>现在我们点击页面上的收藏按钮，点击一次就转换为 <strong>已经收藏</strong>，在点击一次就变成 <strong>未收藏</strong></p>
<p><img src="30.png" alt></p>
<p>但是现在我们点击的还是文字，没有达到我们想要的心号按钮，最主要的是自动刷新才行，这是因为我们的 ajax success 参数并没有设置成功。</p>
<p>我们对视图函数返回给 HTML 页面一个值，如果该值为0则表示未收藏，如果该值为1则表示已收藏。然后加载不同的图片,图片来源：<a href="https://www.iconfont.cn/search/index?searchType=icon&amp;q=%E6%94%B6%E8%97%8F" target="_blank" rel="noopener">阿里巴巴矢量图</a></p>
<p><strong>boards/views.py</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">from django.views.decorators.csrf import csrf_exempt</span><br><span class="line"># 避免报错</span><br><span class="line">@csrf_exempt</span><br><span class="line">def add_favorite(request):</span><br><span class="line">    # 定义收藏用户</span><br><span class="line">    user = request.user</span><br><span class="line">    # Ajax 传回来课程 id</span><br><span class="line">    course_id = request.POST.get(&apos;course_id&apos;)</span><br><span class="line">    # 查询所有的收藏课程信息</span><br><span class="line">    like_courses = user.favorite.all()</span><br><span class="line"></span><br><span class="line">    # 遍历查询如果查到最后都没有匹配的id则表示未收藏进行收藏操作</span><br><span class="line">    # 如果已收藏 但是点击了 则进行删除操作</span><br><span class="line">    for i in like_courses:</span><br><span class="line">        if i.id == int(course_id):</span><br><span class="line">            # print(&apos;已收藏&apos;+str(i.pk))</span><br><span class="line">            # 如果存在收藏列表则删除</span><br><span class="line">            # 定义课程</span><br><span class="line">            course = Courses.objects.get(id=course_id)</span><br><span class="line">            # 课程.favorite.remove(用户)</span><br><span class="line">            course.favorite.remove(user)</span><br><span class="line">            # 可收藏传回0</span><br><span class="line">            return HttpResponse(&apos;0&apos;)</span><br><span class="line">    else:</span><br><span class="line">        pass</span><br><span class="line">    # 用户.favorite.add(课程）</span><br><span class="line">    user.favorite.add(course_id)</span><br><span class="line">    # 已收藏传回1</span><br><span class="line">    return HttpResponse(&apos;1&apos;)</span><br></pre></td></tr></table></figure>
<p><strong>templates/courses.html</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">&#123;% if  course_list %&#125;</span><br><span class="line">&#123;% for course in course_list %&#125;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line"></span><br><span class="line">        &lt;td&gt;&lt;img src=&quot;/static/img/&#123;&#123; course.imgpath &#125;&#125;&quot; height=&quot;135&quot; width=&quot;240&quot;&gt;&lt;/td&gt;</span><br><span class="line"></span><br><span class="line">        &lt;td&gt;&lt;a href=&quot;&#123;&#123; course.course_url &#125;&#125;&quot;&gt;&#123;&#123; course.coursename &#125;&#125;&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;&#123;&#123; course.teachername &#125;&#125;&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;&#123;&#123; course.learnednums&#125;&#125;&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;&#123;&#123; course.score &#125;&#125;&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;&#123;&#123; course.commitsnum &#125;&#125;&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;&#123;&#123; course.source &#125;&#125;&lt;/td&gt;</span><br><span class="line"></span><br><span class="line">        &#123;% if course in like_courses  %&#125;</span><br><span class="line">&#123;#                        判断是否在收藏课程中 如果在的话就可以点击#&#125;</span><br><span class="line">        &lt;td&gt;&lt;a id=&quot;&#123;&#123; course.id &#125;&#125;&quot;&gt;&lt;img src=&quot;&#123;% static &apos;1.png&apos; %&#125;&quot; alt=&quot;&quot; width=&quot;50&quot; height=&quot;50&quot;&gt;&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">        &#123;% else %&#125;</span><br><span class="line">        &lt;td&gt;&lt;a id=&quot;&#123;&#123; course.id &#125;&#125;&quot;&gt;&lt;img src=&quot;&#123;% static &apos;2.png&apos; %&#125;&quot; alt=&quot;&quot; width=&quot;50&quot; height=&quot;50&quot;&gt;&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">        &#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">    &lt;script src=&quot;/static/js/jquery-3.2.1.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">     &lt;script&gt;</span><br><span class="line">        &#123;#点击 course.id 的位置 即收藏按钮#&#125;</span><br><span class="line">        $(&quot;#&#123;&#123; course.id &#125;&#125;&quot;).on(&quot;click&quot;, function () &#123;</span><br><span class="line">            &#123;#将 course.id 定义成一个变量并将其传给 view 视图 #&#125;</span><br><span class="line">            var course_id = &quot;&#123;&#123; course.id &#125;&#125;&quot;;</span><br><span class="line"></span><br><span class="line">            $.ajax(&#123;</span><br><span class="line">                &#123;#路由 给予一个绝对路由 使得在搜索栏也可以添加#&#125;</span><br><span class="line">                url:&quot;http://127.0.0.1:8000/add_favorite&quot;,</span><br><span class="line">                &#123;#request方法#&#125;</span><br><span class="line">                type: &quot;POST&quot;,</span><br><span class="line">                &#123;#传给view视图的参数值#&#125;</span><br><span class="line">                data: &#123;&quot;course_id&quot;: course_id &#125;,</span><br><span class="line">                &#123;#data 表示传回来的参数值#&#125;</span><br><span class="line">                success: function (data) &#123;</span><br><span class="line">                    &#123;#如果值等于0 则显示未收藏的图片#&#125;</span><br><span class="line">                    if (data == &apos;0&apos;) &#123;</span><br><span class="line">                        &#123;#定位 course.id 的位置然后用后面的HTML内容替代#&#125;</span><br><span class="line">                        $(&apos;#&#123;&#123; course.id &#125;&#125;&apos;).html(&quot;&lt;a id=\&quot;&#123;&#123; course.id &#125;&#125;\&quot;&gt;&lt;img src=\&quot;&#123;% static &apos;2.png&apos; %&#125;\&quot; alt=\&quot;\&quot; width=\&quot;50\&quot; height=\&quot;50\&quot;&gt;&lt;/a&gt;&quot;)</span><br><span class="line">                    &#125;</span><br><span class="line">                    &#123;#如果传回来不是0 则显示已收藏的图片#&#125;</span><br><span class="line">                    else &#123;</span><br><span class="line">                        $(&apos;#&#123;&#123; course.id &#125;&#125;&apos;).html(&quot;&lt;a id=\&quot;&#123;&#123; course.id &#125;&#125;\&quot;&gt;&lt;img src=\&quot;&#123;% static &apos;1.png&apos; %&#125;\&quot; alt=\&quot;\&quot; width=\&quot;50\&quot; height=\&quot;50\&quot;&gt;&lt;/a&gt;&lt;/a&gt;&quot;)</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;);</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>
<p><img src="31.png" alt></p>
<h2 id="Search"><a href="#Search" class="headerlink" title="Search"></a>Search</h2><p>从 <strong>BootStrap</strong> 获取搜索栏的表单模型,写在 <code>base.html</code> 文件下，因为我们在所有的页面都要可以进行搜索。</p>
<p><strong>templates/base.html</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- action 不加 search 不工作 千万记住这就是连接视图的地方 --&gt;</span><br><span class="line">&lt;form class=&quot;form-inline my-2 my-lg-0 &quot; action=&quot;search&quot;&gt;</span><br><span class="line">  &lt;input name=&quot;mykey&quot; class=&quot;form-control mr-sm-2&quot; type=&quot;search&quot; placeholder=&quot;Search&quot; aria-label=&quot;Search&quot;&gt;</span><br><span class="line">  &lt;button class=&quot;btn btn-outline-success my-2 my-sm-0&quot; type=&quot;submit&quot;&gt;Search&lt;/button&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure></p>
<p><img src="32.png" alt><br>编写搜索视图函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 搜索页面</span><br><span class="line">from django.db.models import Q</span><br><span class="line">def search(request):</span><br><span class="line">    # 获取用户提交的搜索关键词</span><br><span class="line">    # 与 HTMl 的 input name 关联</span><br><span class="line">    keyStr = request.GET.get(&apos;mykey&apos;)</span><br><span class="line">    # 报错信息</span><br><span class="line">    error_msg =&apos;&apos;</span><br><span class="line">    # 如果没有关键词 则返回错误信息即可</span><br><span class="line">    if not keyStr:</span><br><span class="line">        error_msg =&apos;请输入关键词&apos;</span><br><span class="line">        return render(request,&apos;search.html&apos;, &#123;&apos;error_msg&apos;: error_msg&#125;)</span><br><span class="line">    # teachername__icontains 表示 teachername 中包含关键词 keyStr 前缀i表示不区分大小写</span><br><span class="line">    # icontains  是查询表达式 用法是在模型后需要筛选的属性后面跟上2个下划线</span><br><span class="line">    # Q 用于封装查询表达式 作用是为了提供复杂的查询逻辑</span><br><span class="line">    # Q(teachername__icontains=keyStr)|Q(coursename__icontains=keyStr)</span><br><span class="line">    # 表示 教师名字中含有关键词 或者 课程名中含有关键词</span><br><span class="line">    post_list = Courses.objects.filter(Q(teachername__icontains=keyStr)|Q(coursename__icontains=keyStr))</span><br><span class="line">    return render(request, &apos;search.html&apos;, &#123;&apos;error_msg&apos;: error_msg, &apos;post_list&apos;: post_list&#125;)</span><br></pre></td></tr></table></figure>
<p>路由匹配 </p>
<p><strong>myproject/urls.py</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path(&apos;search&apos;,views.search,name=&apos;search&apos;),</span><br></pre></td></tr></table></figure></p>
<p>搜索结果展示页面</p>
<p><strong>templates/search.html</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends &apos;base.html&apos; %&#125;</span><br><span class="line">&#123;% load static %&#125;</span><br><span class="line">&#123;% block title %&#125;</span><br><span class="line">    Search - &#123;&#123; block.super &#125;&#125;</span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line">&#123;% block breadcrumb %&#125;</span><br><span class="line">    &lt;li class=&quot;breadcrumb-item&quot;&gt;&lt;a href=&quot;#&quot;&gt;Search&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">    &#123;% if error_msg %&#125;</span><br><span class="line">    &#123;#        如果没有输入关键词 则进行报错#&#125;</span><br><span class="line">        &lt;h1&gt;请输入关键词！&lt;/h1&gt;</span><br><span class="line">    &#123;#            存在关键词则展示结果 #&#125;</span><br><span class="line">    &#123;% else %&#125;</span><br><span class="line">        &lt;table class=&quot;table&quot;&gt;</span><br><span class="line">            &lt;thead class=&quot;thead-inverse&quot;&gt;</span><br><span class="line">                &lt;tr&gt;</span><br><span class="line">                    &lt;th&gt;Course Image&lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;Course Name&lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;Teacher&lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;&lt;a href=&quot;&quot;&gt;Learned&lt;/a&gt;&lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;&lt;a href=&quot;&quot;&gt;Score&lt;/a&gt;&lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;Commits Num&lt;/th&gt;</span><br><span class="line">                     &lt;th&gt;Source&lt;/th&gt;</span><br><span class="line">                    &lt;th&gt;Favorite&lt;/th&gt;</span><br><span class="line">                &lt;/tr&gt;</span><br><span class="line">            &lt;/thead&gt;</span><br><span class="line"></span><br><span class="line">            &lt;tbody&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            &#123;% for course in post_list %&#125;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line"></span><br><span class="line">                &lt;td&gt;&lt;img src=&quot;/static/img/&#123;&#123; course.imgpath &#125;&#125;&quot; height=&quot;135&quot; width=&quot;240&quot;&gt;&lt;/td&gt;</span><br><span class="line"></span><br><span class="line">                &lt;td&gt;&lt;a href=&quot;&#123;&#123; course.course_url &#125;&#125;&quot;&gt;&#123;&#123; course.coursename &#125;&#125;&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;&#123;&#123; course.teachername &#125;&#125;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;&#123;&#123; course.learnednums&#125;&#125;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;&#123;&#123; course.score &#125;&#125;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;&#123;&#123; course.commitsnum &#125;&#125;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;&#123;&#123; course.source &#125;&#125;&lt;/td&gt;</span><br><span class="line"></span><br><span class="line">                &#123;% if course in like_courses  %&#125;</span><br><span class="line">    &#123;#                        判断是否在收藏课程中 如果在的话就可以点击#&#125;</span><br><span class="line">                &lt;td&gt;&lt;a id=&quot;&#123;&#123; course.id &#125;&#125;&quot;&gt;&lt;img src=&quot;&#123;% static &apos;1.png&apos; %&#125;&quot; alt=&quot;&quot; width=&quot;50&quot; height=&quot;50&quot;&gt;&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">                &#123;% else %&#125;</span><br><span class="line">                &lt;td&gt;&lt;a id=&quot;&#123;&#123; course.id &#125;&#125;&quot;&gt;&lt;img src=&quot;&#123;% static &apos;2.png&apos; %&#125;&quot; alt=&quot;&quot; width=&quot;50&quot; height=&quot;50&quot;&gt;&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">                &#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;script src=&quot;/static/js/jquery-3.2.1.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">            &lt;script&gt;</span><br><span class="line">                $(&quot;#&#123;&#123; course.id &#125;&#125;&quot;).on(&quot;click&quot;, function () &#123;</span><br><span class="line">                    var course_id = &quot;&#123;&#123; course.id &#125;&#125;&quot;;</span><br><span class="line">                    var ss = document.getElementById(&apos;sss&apos;);</span><br><span class="line">                    $.ajax(&#123;</span><br><span class="line">                        url: &quot;http://127.0.0.1:8000/add_favorite&quot;,</span><br><span class="line">                        type: &quot;POST&quot;,</span><br><span class="line">                        data: &#123;&quot;course_id&quot;: course_id &#125;,</span><br><span class="line">                        success: function (data) &#123;</span><br><span class="line">                            if (data == &apos;0&apos;) &#123;</span><br><span class="line">                                $(&apos;#&#123;&#123; course.id &#125;&#125;&apos;).html(&quot;&lt;a id=\&quot;&#123;&#123; course.id &#125;&#125;\&quot;&gt;&lt;img src=\&quot;&#123;% static &apos;2.png&apos; %&#125;\&quot; alt=\&quot;\&quot; width=\&quot;50\&quot; height=\&quot;50\&quot;&gt;&lt;/a&gt;&quot;)</span><br><span class="line">                            &#125;</span><br><span class="line">                            else &#123;</span><br><span class="line">                                $(&apos;#&#123;&#123; course.id &#125;&#125;&apos;).html(&quot;&lt;a id=\&quot;&#123;&#123; course.id &#125;&#125;\&quot;&gt;&lt;img src=\&quot;&#123;% static &apos;1.png&apos; %&#125;\&quot; alt=\&quot;\&quot; width=\&quot;50\&quot; height=\&quot;50\&quot;&gt;&lt;/a&gt;&lt;/a&gt;&quot;)</span><br><span class="line">                            &#125;</span><br><span class="line"></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;);</span><br><span class="line">            &lt;/script&gt;</span><br><span class="line">        &#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line">        &lt;/tbody&gt;</span><br><span class="line">        &lt;/table&gt;</span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>
<p>如果输入合适的关键词，将会在课程名字和教师名称中进行匹配，而且搜索结果页面还可以进行收藏课程。</p>
<p><img src="33.png" alt></p>
<p>如果不输入关键词，则会报错提醒</p>
<p><img src="34.png" alt></p>
<h1 id="Like"><a href="#Like" class="headerlink" title="Like"></a>Like</h1><p>开发好了 Course 页面的大部分功能之后，我们需要继续开发个人收藏页面。<br>因为我们之前已经开发好了路由和 <code>view</code> 函数以及 HTML 模板，现在只需要修改 HTML 模板引入一个相对来说比较合适的 <code>Table</code>。<br>我们进入到 <a href="https://v4.bootcss.com/docs/content/tables/" target="_blank" rel="noopener">Bootstrap - Table </a>,你可以在这下面寻找到一个适合你的模板文件。<br>然后将其修改成符合我们布局要求的如下样式</p>
<p><img src="35.png" alt></p>
<p>然后修改视图函数，如果没有收藏信息则返回提醒当前并没有收藏课程，如果有的话就直接展示出来，在当前页面，我们也可以进行取消收藏的操作。</p>
<p><img src="36.png" alt></p>
<h1 id="Data-Analysis"><a href="#Data-Analysis" class="headerlink" title="Data Analysis"></a>Data Analysis</h1><p>用户界面全部都开发好了，现在我们进入可视化界面的开发，这里使用的是 <code>Echart</code> 和 <code>Ajax</code> 的组合。</p>
<h2 id="Echart"><a href="#Echart" class="headerlink" title="Echart"></a>Echart</h2><p>我们进入到百度的这个开源框架首页 <a href="https://www.echartsjs.com/zh/tutorial.html#5%20%E5%88%86%E9%92%9F%E4%B8%8A%E6%89%8B%20ECharts" target="_blank" rel="noopener">Echart</a>,进入到 <a href="https://github.com/apache/incubator-echarts/releases" target="_blank" rel="noopener">Github Download</a>,</p>
<p><img src="37.png" alt></p>
<p>当然，只有 <strong>echart.js</strong> 是我们必不可少的，你只需要在 <code>incubator-echarts-4.7.0\dist</code>  下找到 <code>echart.min.js</code> 即可，将其复制到我们的 <code>static\js</code> 文件夹下，在 <code>templates/base.html</code> 文件中引入该 js 文件 。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=&quot;&#123;% static &apos;js/echart.js&apos; %&#125;&quot;&gt;&lt;/script&gt;&#123;#这里#&#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="38.png" alt></p>
<h2 id="Pandas-amp-Matplotlib"><a href="#Pandas-amp-Matplotlib" class="headerlink" title="Pandas &amp; Matplotlib"></a>Pandas &amp; Matplotlib</h2><p>我们需要先将数据从数据库读取出来，然后在 <strong>Matplotlib</strong> 中先做出来我们想要的样式，然后再将处理好的数据通过视图函数传递给前端 Ajax 页面，最后在同一个页面使用 <strong>Echart</strong> 画出来四个可视化图形。</p>
<p>我们将使用 <strong>Pandas</strong> 来访问数据库的数据</p>
<p><img src="39.png" alt></p>
<p>我们先在本地将数据分析可视化展示出来 <strong>Data Analysis.ipynb</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">#%%</span><br><span class="line">&apos;&apos;&apos;</span><br><span class="line">Pandas  And Matplotlib 处理数据库数据进行可视化</span><br><span class="line"></span><br><span class="line">&apos;&apos;&apos;</span><br><span class="line"></span><br><span class="line">import pandas as pd</span><br><span class="line">import matplotlib.pyplot as plt</span><br><span class="line">%matplotlib inline</span><br><span class="line">import pymysql</span><br><span class="line">db = pymysql.connect(host=&apos;127.0.0.1&apos;,</span><br><span class="line">                     port=3306,</span><br><span class="line">                     user=&apos;root&apos;, # 数据库用户名字</span><br><span class="line">                     password=&apos;password&apos;, # 数据库密码</span><br><span class="line">                     db=&apos;bishe&apos;,# 数据库的名字</span><br><span class="line">                     charset=&apos;utf8&apos;)</span><br><span class="line">courses  = pd.read_sql(&apos;select * from boards_courses&apos;,db)</span><br><span class="line">print(courses.head())</span><br><span class="line">#%%</span><br><span class="line"># 数据库存储字段对应 1-java 2-python 3-网络安全 4-c/C++/C#</span><br><span class="line"></span><br><span class="line"># 1. 四类免费课程的数量</span><br><span class="line">direction = courses[&apos;direction&apos;]</span><br><span class="line"># print(direction)</span><br><span class="line"># 遍历分类数据 将其添加到列表中</span><br><span class="line">direction_key_list = [&apos;Java&apos;,&apos;Python&apos;,&apos;网络安全&apos;,&apos;C/C++/C#&apos;]</span><br><span class="line">direction_key_nums =[0,0,0,0]</span><br><span class="line"># 遍历 </span><br><span class="line">for i in direction:</span><br><span class="line">    # 定位数据 然后进行自增</span><br><span class="line">    direction_key_nums[int(i)-1]+=1</span><br><span class="line">print(direction_key_list)</span><br><span class="line">print(direction_key_nums)</span><br><span class="line"></span><br><span class="line"># 另一种求和方法</span><br><span class="line"># count_direction = pd.value_counts(courses[&apos;direction&apos;],ascending=True)</span><br><span class="line"># count_direction</span><br><span class="line"></span><br><span class="line">plt.rcParams[&apos;font.sans-serif&apos;] = [&apos;SimHei&apos;]  #显示中文</span><br><span class="line">plt.rcParams[&apos;axes.unicode_minus&apos;]=False #用来正常显示负号</span><br><span class="line">plt.pie(direction_key_nums,labels=direction_key_list,autopct=&apos;%1.1f%%&apos;,shadow=False,startangle=150)</span><br><span class="line">#%%</span><br><span class="line"># 2、四类（Python、Java、网络安全、C/C++/C#）免费课程的总参与人数</span><br><span class="line">leared_list =[]</span><br><span class="line">for i in range(4):</span><br><span class="line">    learned_nums = courses[courses[&apos;direction&apos;]==str(i+1)][&apos;learnednums&apos;].sum()</span><br><span class="line">#     print(direction_key_list[i])</span><br><span class="line">    leared_list.append(learned_nums)</span><br><span class="line">#     print(learned_nums)</span><br><span class="line">print(leared_list)</span><br><span class="line">plt.bar(x=direction_key_list, height=leared_list, )</span><br><span class="line">#%%</span><br><span class="line"># 3、此课程参与人数分布与此课程下的评论数对比（散点图）</span><br><span class="line">persons = courses[&apos;learnednums&apos;]</span><br><span class="line">commitsnums = courses[&apos;commitsnum&apos;]</span><br><span class="line">plt.scatter(persons,commitsnums)</span><br><span class="line">#%%</span><br><span class="line"># 4.参与人数和评分的散点图</span><br><span class="line">persons = courses[&apos;learnednums&apos;]</span><br><span class="line">scores = courses[&apos;score&apos;]</span><br><span class="line">plt.scatter(persons,scores)</span><br><span class="line">#%%</span><br></pre></td></tr></table></figure>
<p><img src="40.png" alt><br><img src="41.png" alt><br><img src="42.png" alt><br><img src="43.png" alt></p>
<h2 id="Django-Analysis"><a href="#Django-Analysis" class="headerlink" title="Django Analysis"></a>Django Analysis</h2><p><strong>myproject/urls.py</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 可视化页面</span><br><span class="line">path(&apos;data_analysis&apos;,views.data_analysis,name=&apos;data_analysis&apos;),</span><br></pre></td></tr></table></figure></p>
<p><strong>boards/views.py</strong> 处理数据并将数据传给前端，直接调用即可。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># 可视化页面</span><br><span class="line">import pandas as pd</span><br><span class="line"># 配置 pymysql 方便 pandas 调用</span><br><span class="line">import pymysql</span><br><span class="line">db = pymysql.connect(host=&apos;127.0.0.1&apos;,</span><br><span class="line">                     port=3306,</span><br><span class="line">                     user=&apos;root&apos;, # 数据库用户名字</span><br><span class="line">                     password=&apos;password&apos;, # 数据库密码</span><br><span class="line">                     db=&apos;bishe&apos;,# 数据库的名字</span><br><span class="line">                     charset=&apos;utf8&apos;)</span><br><span class="line">def data_analysis(request):</span><br><span class="line">    # 使用 pd 来读取数据库的数据</span><br><span class="line">    courses = pd.read_sql(&apos;select * from boards_courses&apos;, db)</span><br><span class="line">    # 为了展示 Board  所以还是要返回一个board 对象</span><br><span class="line">    board = Board.objects.all()</span><br><span class="line">    # 柱状图 饼状图的 x轴</span><br><span class="line">    direction_key_list = [&apos;Java&apos;, &apos;Python&apos;, &apos;网络安全&apos;, &apos;C/C++/C#&apos;]</span><br><span class="line">    # 存储课程数量</span><br><span class="line">    direction_key_nums = [0, 0, 0, 0]</span><br><span class="line">    # 读取课程分类</span><br><span class="line">    direction = courses[&apos;direction&apos;]</span><br><span class="line">    # 遍历</span><br><span class="line">    for i in direction:</span><br><span class="line">        # 定位数据 然后进行自增</span><br><span class="line">        direction_key_nums[int(i) - 1] += 1</span><br><span class="line">    return render(request,&apos;Data_Analysis.html&apos;, &#123;&apos;direction_key_list&apos;:direction_key_list,&apos;direction_key_nums&apos;:direction_key_nums,&#125; )</span><br></pre></td></tr></table></figure>
<p><strong>templates/Data_Analysis.html</strong> 这里有一个需要注意的点，必须在可视化之前，将 <code>echarts.js</code> 引入，否则会一直报错。<br>我们在 View 里面构建好了传入给 <strong>HTML</strong> 模板的数据，直接在 HTML 中使用 <code>direction_key_nums|safe</code> 即可引入，注意下 safe 的用法，避免乱码。因为我们并不是动态数据，仅仅是将数据处理好便会渲染。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends &apos;base.html&apos; %&#125;</span><br><span class="line">&#123;% load static %&#125;</span><br><span class="line">&#123;% block title %&#125;</span><br><span class="line">    Data analysis - &#123;&#123; block.super &#125;&#125;</span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line">&#123;% block breadcrumb %&#125;</span><br><span class="line">    &lt;li class=&quot;breadcrumb-item&quot;&gt;&lt;a href=&quot;&#123;% url &apos;home&apos; %&#125;&quot;&gt;Boards&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">    &lt;li class=&quot;breadcrumb-item active&quot;&gt;Data Analysis&lt;/li&gt;</span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">    &lt;h1&gt;Data analysis&lt;/h1&gt;</span><br><span class="line">     &lt;div class=&quot;main_table t_btn3&quot; id=&quot;chart_9&quot; style=&quot;width: 100%; height: 280px; -webkit-tap-highlight-color: transparent; user-select: none; position: relative;&quot;&gt;&lt;/div&gt;</span><br><span class="line">    &#123;#    关键，必须在可视化之前导入第三方js文件否则会报错#&#125;</span><br><span class="line">    &lt;script src=&quot;&#123;% static &apos;js/echarts.min.js&apos; %&#125;&quot;&gt;&lt;/script&gt;&#123;#这里#&#125;</span><br><span class="line">    &lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">        // 基于准备好的dom，初始化echarts实例</span><br><span class="line">        console.log(name);</span><br><span class="line">        # 根据id来匹配div 注意该id和div的id相一致</span><br><span class="line">        var myChart = echarts.init(document.getElementById(&apos;chart_9&apos;));</span><br><span class="line"></span><br><span class="line">        // 指定图表的配置项和数据</span><br><span class="line">        var option = &#123;</span><br><span class="line">            title: &#123;</span><br><span class="line">                text: &apos;ECharts 入门示例&apos;</span><br><span class="line">            &#125;,</span><br><span class="line">            tooltip: &#123;&#125;,</span><br><span class="line">            legend: &#123;</span><br><span class="line">                data:[&apos;学习人数&apos;]</span><br><span class="line">            &#125;,</span><br><span class="line">            xAxis: &#123;</span><br><span class="line">                &lt;!-- 直接使用双括号的形式引入数据 在view视图中直接传入即可 --&gt;</span><br><span class="line">                data: &#123;&#123; direction_key_list|safe &#125;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            yAxis: &#123;&#125;,</span><br><span class="line">            series: [&#123;</span><br><span class="line">                name: &apos;学习人数&apos;,</span><br><span class="line">                type: &apos;bar&apos;,</span><br><span class="line">                data:&#123;&#123; direction_key_nums|safe &#125;&#125;</span><br><span class="line">            &#125;]</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        // 使用刚指定的配置项和数据显示图表。</span><br><span class="line">        myChart.setOption(option);</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>
<p><img src="44.png" alt></p>
<p><strong>这是实现 Django Echart 的可视化，但是我们还需要构建更加适合可视化的数据结构，以实现四个图的布局。 <a href="https://www.echartsjs.com/examples/zh/editor.html?c=pie-custom" target="_blank" rel="noopener">Echart Example</a> 可以供我们参考。思路都相同，不同的是处理合适的数据结构传给前端，适配 Echart 的布局。</strong></p>
<p><strong>boards/views.py</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"># 可视化页面</span><br><span class="line">import pandas as pd</span><br><span class="line"># 配置 pymysql 方便 pandas 调用</span><br><span class="line">import pymysql</span><br><span class="line">db = pymysql.connect(host=&apos;127.0.0.1&apos;,</span><br><span class="line">                     port=3306,</span><br><span class="line">                     user=&apos;root&apos;, # 数据库用户名字</span><br><span class="line">                     password=&apos;password&apos;, # 数据库密码</span><br><span class="line">                     db=&apos;bishe&apos;,# 数据库的名字</span><br><span class="line">                     charset=&apos;utf8&apos;)</span><br><span class="line">def data_analysis(request):</span><br><span class="line">    # 使用 pd 来读取数据库的数据</span><br><span class="line">    courses = pd.read_sql(&apos;select * from boards_courses&apos;, db)</span><br><span class="line">    # 为了展示 Board  所以还是要返回一个board 对象</span><br><span class="line">    board = Board.objects.all()</span><br><span class="line"></span><br><span class="line">    # 饼状图</span><br><span class="line">    direction_key_list = [&apos;Java&apos;, &apos;Python&apos;, &apos;网络安全&apos;, &apos;C/C++/C#&apos;]</span><br><span class="line">    # 存储课程数量</span><br><span class="line">    direction_key_nums = [0, 0, 0, 0]</span><br><span class="line">    # 读取课程分类</span><br><span class="line">    direction = courses[&apos;direction&apos;]</span><br><span class="line">    # 遍历</span><br><span class="line">    for i in direction:</span><br><span class="line">        # 定位数据 然后进行自增</span><br><span class="line">        direction_key_nums[int(i) - 1] += 1</span><br><span class="line">    # 拼接字典 传给前端方便构建pie的可视化字典数据结构</span><br><span class="line">    direction_dict =&#123;&#125;</span><br><span class="line">    for i in range(len(direction_key_list)):</span><br><span class="line">        direction_dict[direction_key_list[i]] = direction_key_nums[i]</span><br><span class="line"></span><br><span class="line">    # 柱状图</span><br><span class="line">    leared_list = []</span><br><span class="line">    for i in range(4):</span><br><span class="line">        learned_nums = courses[courses[&apos;direction&apos;] == str(i + 1)][&apos;learnednums&apos;].sum()</span><br><span class="line">        #     print(direction_key_list[i])</span><br><span class="line">        leared_list.append(learned_nums)</span><br><span class="line">    #     print(learned_nums)</span><br><span class="line">    # print(leared_list)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    # 散点图1 学习人数和评论数占比</span><br><span class="line">    persons = list(courses[&apos;learnednums&apos;])</span><br><span class="line">    commitsnums = list(courses[&apos;commitsnum&apos;])</span><br><span class="line">    scatter_data =[]</span><br><span class="line">    for i in range(len(persons)):</span><br><span class="line">        scatter_data.append([persons[i],commitsnums[i]])</span><br><span class="line">    print(scatter_data)</span><br><span class="line"></span><br><span class="line">    # 散点图2 参与人数与评分</span><br><span class="line">    persons = courses[&apos;learnednums&apos;]</span><br><span class="line">    scores = courses[&apos;score&apos;]</span><br><span class="line">    scatter_data2 = []</span><br><span class="line">    for i in range(len(persons)):</span><br><span class="line">        scatter_data2.append([persons[i], scores[i]])</span><br><span class="line">    print(scatter_data2)</span><br><span class="line">    return render(request,&apos;Data_Analysis.html&apos;, &#123;&apos;direction_key_list&apos;:direction_key_list,&apos;direction_key_nums&apos;:direction_key_nums,&apos;direction_dict&apos;:direction_dict,&apos;leared_list&apos;:leared_list,&apos;scatter_data&apos;:scatter_data,&apos;persons&apos;:persons,&apos;commitsnums&apos;:commitsnums,&apos;scatter_data2&apos;:scatter_data2&#125; )</span><br></pre></td></tr></table></figure>
<p><strong>templates/Data_Analysis.html</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends &apos;base.html&apos; %&#125;</span><br><span class="line">&#123;% load static %&#125;</span><br><span class="line">&#123;% block title %&#125;</span><br><span class="line">    Data analysis - &#123;&#123; block.super &#125;&#125;</span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line">&#123;% block breadcrumb %&#125;</span><br><span class="line">    &lt;li class=&quot;breadcrumb-item&quot;&gt;&lt;a href=&quot;&#123;% url &apos;home&apos; %&#125;&quot;&gt;Boards&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">    &lt;li class=&quot;breadcrumb-item active&quot;&gt;Data Analysis&lt;/li&gt;</span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">    &lt;h1&gt;Data analysis&lt;/h1&gt;</span><br><span class="line">     &lt;div class=&quot;main_table t_btn3&quot; id=&quot;chart_1&quot; style=&quot;width: 100%; height: 280px; -webkit-tap-highlight-color: transparent; user-select: none; position: relative;&quot;&gt;&lt;/div&gt;</span><br><span class="line">    &lt;div class=&quot;main_table t_btn3&quot; id=&quot;chart_2&quot; style=&quot;width: 100%; height: 280px; -webkit-tap-highlight-color: transparent; user-select: none; position: relative;&quot;&gt;&lt;/div&gt;</span><br><span class="line">    &lt;div class=&quot;main_table t_btn3&quot; id=&quot;chart_3&quot; style=&quot;width: 100%; height: 280px; -webkit-tap-highlight-color: transparent; user-select: none; position: relative;&quot;&gt;&lt;/div&gt;</span><br><span class="line">    &lt;div class=&quot;main_table t_btn3&quot; id=&quot;chart_4&quot; style=&quot;width: 100%; height: 280px; -webkit-tap-highlight-color: transparent; user-select: none; position: relative;&quot;&gt;&lt;/div&gt;</span><br><span class="line">    &#123;#    关键，必须在可视化之前导入第三方js文件否则会报错#&#125;</span><br><span class="line">    &lt;script src=&quot;&#123;% static &apos;js/echarts.min.js&apos; %&#125;&quot;&gt;&lt;/script&gt;&#123;#这里#&#125;</span><br><span class="line">    &lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">        // 基于准备好的dom，初始化echarts实例</span><br><span class="line">        console.log(name);</span><br><span class="line">        var myChart1 = echarts.init(document.getElementById(&apos;chart_1&apos;));</span><br><span class="line">        // 指定图表的配置项和数据</span><br><span class="line">        var kv = new Array();//声明一个新的字典</span><br><span class="line">            kv = &#123;&#123; direction_dict|safe &#125;&#125;;//取出后台传递的数据，此处添加safe过滤避免警告</span><br><span class="line">            var test = new Array();//声明一个新的字典用于存放数据</span><br><span class="line">            for (var logKey in kv) &#123;</span><br><span class="line">            //将对应键值对取出存入test，logKey 为该字典的键</span><br><span class="line">            test.push(&#123;value: kv[logKey], name: logKey&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        var option1 = &#123;</span><br><span class="line">            title: &#123;</span><br><span class="line">                text: &apos;课程数占比&apos;</span><br><span class="line">            &#125;,</span><br><span class="line">            tooltip: &#123;</span><br><span class="line">                trigger: &apos;item&apos;,</span><br><span class="line">                formatter: &apos;&#123;a&#125; &lt;br/&gt;&#123;b&#125; : &#123;c&#125; (&#123;d&#125;%)&apos;</span><br><span class="line">            &#125;,</span><br><span class="line">            visualMap: &#123;</span><br><span class="line">                show: false,</span><br><span class="line">                min: 80,</span><br><span class="line">                max: 600,</span><br><span class="line">                inRange: &#123;</span><br><span class="line">                    colorLightness: [0, 1]</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line"></span><br><span class="line">            series: [</span><br><span class="line">                &#123;</span><br><span class="line">                    name: &apos;课程数&apos;,</span><br><span class="line">                    type: &apos;pie&apos;,</span><br><span class="line">                    radius: &apos;55%&apos;,</span><br><span class="line">                    center: [&apos;50%&apos;, &apos;50%&apos;],</span><br><span class="line">                    &#123;#赋值方式为字典传值#&#125;</span><br><span class="line">                    data:test.sort(function (a, b) &#123; return a.value - b.value; &#125;),</span><br><span class="line">                    roseType: &apos;radius&apos;,</span><br><span class="line">                    label: &#123;</span><br><span class="line">                        color: &apos;rgba(255, 255, 255, 0.3)&apos;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    labelLine: &#123;</span><br><span class="line">                        lineStyle: &#123;</span><br><span class="line">                            color: &apos;rgba(255, 255, 255, 0.3)&apos;</span><br><span class="line">                        &#125;,</span><br><span class="line">                        smooth: 0.2,</span><br><span class="line">                        length: 10,</span><br><span class="line">                        length2: 20</span><br><span class="line">                    &#125;,</span><br><span class="line">                    itemStyle: &#123;</span><br><span class="line">                        color: &apos;#c23531&apos;,</span><br><span class="line">                        shadowBlur: 200,</span><br><span class="line">                        shadowColor: &apos;rgba(0, 0, 0, 0.5)&apos;</span><br><span class="line">                    &#125;,</span><br><span class="line"></span><br><span class="line">                    animationType: &apos;scale&apos;,</span><br><span class="line">                    animationEasing: &apos;elasticOut&apos;,</span><br><span class="line">                    animationDelay: function (idx) &#123;</span><br><span class="line">                        return Math.random() * 200;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;;</span><br><span class="line">        // 使用刚指定的配置项和数据显示图表。</span><br><span class="line">        myChart1.setOption(option1);</span><br><span class="line"></span><br><span class="line">        var myChart2 = echarts.init(document.getElementById(&apos;chart_2&apos;));</span><br><span class="line">        // 指定图表的配置项和数据</span><br><span class="line">        var option2 = &#123;</span><br><span class="line">            title: &#123;</span><br><span class="line">                text: &apos;学习人数柱状图&apos;</span><br><span class="line">            &#125;,</span><br><span class="line">            tooltip: &#123;&#125;,</span><br><span class="line">            legend: &#123;</span><br><span class="line">                data:[&apos;学习人数&apos;]</span><br><span class="line">            &#125;,</span><br><span class="line">            xAxis: &#123;</span><br><span class="line">                data: &#123;&#123; direction_key_list|safe &#125;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            yAxis: &#123;&#125;,</span><br><span class="line">            series: [&#123;</span><br><span class="line">                name: &apos;学习人数&apos;,</span><br><span class="line">                type: &apos;bar&apos;,</span><br><span class="line">                data:&#123;&#123; leared_list|safe &#125;&#125;</span><br><span class="line">            &#125;]</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        // 使用刚指定的配置项和数据显示图表。</span><br><span class="line">        myChart2.setOption(option2);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        // 第三个图 https://www.echartsjs.com/examples/zh/editor.html?c=scatter-clustering-process</span><br><span class="line">        var myChart3 = echarts.init(document.getElementById(&apos;chart_3&apos;));</span><br><span class="line">        var option3 = &#123;</span><br><span class="line">            title: &#123;</span><br><span class="line">                text: &apos;学习人数与评价数&apos;</span><br><span class="line">            &#125;,</span><br><span class="line">            xAxis: &#123;</span><br><span class="line">            &#125;,</span><br><span class="line">            yAxis: &#123;</span><br><span class="line">            &#125;,</span><br><span class="line">            series: [&#123;</span><br><span class="line">                // 设置点的大小</span><br><span class="line">                symbolSize: 10,</span><br><span class="line">                data:&#123;&#123; scatter_data &#125;&#125;,</span><br><span class="line">                type: &apos;scatter&apos;</span><br><span class="line">            &#125;]</span><br><span class="line">        &#125;;</span><br><span class="line">        // 使用刚指定的配置项和数据显示图表。</span><br><span class="line">        myChart3.setOption(option3);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        var myChart4 = echarts.init(document.getElementById(&apos;chart_4&apos;));</span><br><span class="line">        // 指定图表的配置项和数据</span><br><span class="line">        var option4 = &#123;</span><br><span class="line">            title: &#123;</span><br><span class="line">                text: &apos;学习人数与评分&apos;</span><br><span class="line">            &#125;,</span><br><span class="line">            xAxis: &#123;</span><br><span class="line">            &#125;,</span><br><span class="line">            yAxis: &#123;</span><br><span class="line">            &#125;,</span><br><span class="line">            series: [&#123;</span><br><span class="line">                data:&#123;&#123; scatter_data2 &#125;&#125;,</span><br><span class="line">                type: &apos;scatter&apos;,</span><br><span class="line">                symbolSize:10,</span><br><span class="line">            &#125;]</span><br><span class="line">        &#125;;</span><br><span class="line">        // 使用刚指定的配置项和数据显示图表。</span><br><span class="line">        myChart4.setOption(option4);</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>
<p><img src="45.png" alt></p>
<h1 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h1><h2 id="未登录不可访问"><a href="#未登录不可访问" class="headerlink" title="未登录不可访问"></a>未登录不可访问</h2><p>设置未登录访问课程信息，在 View 视图中的函数 <strong>前一行</strong> 输入如下的代码，所有的函数都加下如下的装饰器，使得未登录不可查看。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">from django.contrib.auth.decorators import login_required</span><br><span class="line"># 避免它被未登录的用户访问</span><br><span class="line">@login_required</span><br></pre></td></tr></table></figure>
<h2 id="散点图分布"><a href="#散点图分布" class="headerlink" title="散点图分布"></a>散点图分布</h2><p>上面的可视化结果，散点图还是分布的不是很均匀，后面的太少但是拉长了横坐标，所以在后台删去一部分的数据，将其缩小到40万以下。</p>
<p>因为我本身就是用的 Pandas 处理数据库的数据，然后转成列表传给前端模板，所以清洗数据的长度还是很轻松的，只需要在 <strong>For</strong> 中添加一个判断语句即可。当学习人数的值超过 <strong>40万</strong> ，则直接给定一个 <strong>39万+随机值</strong>。</p>
<p><img src="46.png" alt></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"> # 散点图1 学习人数和评论数占比</span><br><span class="line">persons = list(courses[&apos;learnednums&apos;])</span><br><span class="line">commitsnums = list(courses[&apos;commitsnum&apos;])</span><br><span class="line">scatter_data =[]</span><br><span class="line">for i in range(len(persons)):</span><br><span class="line">    if persons[i]&gt; 400000:</span><br><span class="line">        # 超出的部分在 39万的基础上随机加一个值 减少横坐标的长度</span><br><span class="line">        scatter_data.append([390000+random.randint(200,5000), commitsnums[i]])</span><br><span class="line">    else:</span><br><span class="line">        scatter_data.append([ persons[i], commitsnums[i]])</span><br><span class="line">print(scatter_data)</span><br><span class="line"></span><br><span class="line"># 散点图2 参与人数与评分</span><br><span class="line">persons = courses[&apos;learnednums&apos;]</span><br><span class="line">scores = courses[&apos;score&apos;]</span><br><span class="line">scatter_data2 = []</span><br><span class="line">for i in range(len(persons)):</span><br><span class="line">    if persons[i]&gt; 400000:</span><br><span class="line">        # 超出的部分在 39万的基础上随机加一个值</span><br><span class="line">        scatter_data2.append([390000+random.randint(200,5000), scores[i]])</span><br><span class="line">    else:</span><br><span class="line">        scatter_data2.append([ persons[i], scores[i]])</span><br><span class="line">print(scatter_data2)</span><br></pre></td></tr></table></figure>
<p>由于点分布太大，导致很多重叠的显示，并不是那么好看，所以我们进入到 <strong>templates/Data_Analysis.html</strong> 下修改 script 下的参数即可。数字越小点越小</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 设置点的大小</span><br><span class="line">symbolSize: 5,</span><br></pre></td></tr></table></figure>
<p><img src="47.png" alt></p>
<h2 id="Spyder-优化"><a href="#Spyder-优化" class="headerlink" title="Spyder 优化"></a>Spyder 优化</h2><p>因为我们之前的爬虫只是进行抓取入库，但是没有更新的功能，也没有定时启动，这个也不困难。我们只需要在入库之前进行搜索。我们在设计数据库表的时候 设置的表主键就是 <strong>course_url</strong> 。我们现在只需要查询当前的是否存在，如果存在则更新数据，不存在则插入数据。</p>
<p>实现变量的查询语句：<strong>直接使用 format 语法来填充即可</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"># 首先进行查询主键 course_url 如果存在则更新数据 不存在则插入数据</span><br><span class="line"># 构建查询语句 使用变量来查询 注意前后的引号</span><br><span class="line">select_sql = &apos;select * from courseinfo where course_url =&quot;&apos; + course_url + &apos;&quot;&apos;</span><br><span class="line"># 执行查询语句</span><br><span class="line">cursor.execute(select_sql)</span><br><span class="line"># 将查询结果转为列表形式 因为我们就只有一条结果 所以获取第一条即可</span><br><span class="line">if cursor.execute(select_sql) == 1:</span><br><span class="line">    content = cursor.fetchall()[0]</span><br><span class="line">    # 对其进行输出</span><br><span class="line">    print(content)</span><br><span class="line">    # 查到了就更想 评论数 学习人数 评分数三个指标</span><br><span class="line">    update_sql = &apos;UPDATE courseinfo set commitsnums =&#123;&#125; where course_url =&quot;&#123;&#125;&quot;&apos;.format(commits_nums, course_url)</span><br><span class="line">    cursor.execute(update_sql)</span><br><span class="line">    update_sql2 = &apos;UPDATE courseinfo set learnednums =&#123;&#125; where course_url =&quot;&#123;&#125;&quot;&apos;.format(learned_nums, course_url)</span><br><span class="line">    cursor.execute(update_sql2)</span><br><span class="line">    update_sql3 = &apos;UPDATE courseinfo set score =&#123;&#125; where course_url =&quot;&#123;&#125;&quot;&apos;.format(score, course_url)</span><br><span class="line">    cursor.execute(update_sql3)</span><br><span class="line">    db.commit()</span><br><span class="line">else:</span><br><span class="line">    print(&apos;没有查询到执行直接插入语句&apos;)</span><br><span class="line">    # 使用pymysql.escape_string()函数是为了避免有别的字符串导致入库报错 但是如果是数字的话即不需要使用</span><br><span class="line">    sql_1 = &quot;&quot;&quot;</span><br><span class="line">            INSERT IGNORE INTO courseinfo (course_url,commitsnums,imgurl,coursename,learnednums,score,teacher,technicaldirection)VALUES(&apos;&#123;&#125;&apos;,&apos;&#123;&#125;&apos;,&apos;&#123;&#125;&apos;,&apos;&#123;&#125;&apos;,&apos;&#123;&#125;&apos;,&apos;&#123;&#125;&apos;,&apos;&#123;&#125;&apos;,&apos;&#123;&#125;&apos; )</span><br><span class="line">            &quot;&quot;&quot; \</span><br><span class="line">        .format(</span><br><span class="line">        pymysql.escape_string(course_url),</span><br><span class="line">        pymysql.escape_string(commits_nums),</span><br><span class="line">        pymysql.escape_string(img_url),</span><br><span class="line">        pymysql.escape_string(course_name),</span><br><span class="line">        pymysql.escape_string(learned_nums),</span><br><span class="line">        score,</span><br><span class="line">        pymysql.escape_string(teacher),</span><br><span class="line">        pymysql.escape_string(Technical_direction),</span><br><span class="line">    )</span><br><span class="line">    # print(sql_2)</span><br><span class="line">    cursor.execute(sql_1)  # 执行命令</span><br><span class="line">    db.commit()  # 提交事务</span><br></pre></td></tr></table></figure>
<p>对三个部分的代码有关入库的部分全部做入上更新即可。</p>
<h2 id="定时更新"><a href="#定时更新" class="headerlink" title="定时更新"></a>定时更新</h2><p>每7天自动跑一次代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import time</span><br><span class="line">time.sleep(60*60*24*7)</span><br></pre></td></tr></table></figure>
<h1 id="Conclusions"><a href="#Conclusions" class="headerlink" title="Conclusions"></a>Conclusions</h1><p>这里总结下思路，方便你整理的回顾项目。</p>
<ul>
<li>爬虫：首先，我们需要去到三个网站，开发出来基于三个网站的不同爬虫策略，并根据不同的分类入库到同一个数据库的同一张表。数据入库之后，我们需要通过脚本来处理数据并入库到 <strong>Django Models</strong> 中。</li>
<li>Django：构建 <strong>Models</strong> ，然后将数据入库之后，先构建用户系统。再来布局首页，以及各个分类的课程信息展示页面。继续实现排序、收藏功能。个人收藏课程信息页面、可视化分析页面。然后实现限制必须登录才访问主页的装饰器，</li>
</ul>
<blockquote>
<p>主要难点在于 Ajax 和 视图函数的配合，以及视图函数和 Echart 的配合。两者都不仅仅需要 Django 基础，而且 JS 越熟悉开发起来越迅速。下面列举下所有涉及的技术和开发工具</p>
</blockquote>
<ul>
<li><strong>Python 3.7</strong></li>
<li><strong>Django 2.2</strong></li>
<li><strong>Mysql 8</strong></li>
<li><strong>Echart 4</strong></li>
<li><strong>BootStrap</strong></li>
<li><strong>HTML | CSS | JS</strong></li>
<li><strong>Selenium</strong></li>
<li><strong>Request</strong> </li>
<li><strong>Beautiful Soup</strong></li>
<li><strong>AJAX</strong></li>
</ul>
<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ul>
<li><a href="https://blog.51cto.com/12965094/2393910?source=dra" target="_blank" rel="noopener">Django 外键的作用与反作用</a></li>
<li><a href="https://www.liujiangblog.com/course/django/98" target="_blank" rel="noopener">多对多中间表详解</a></li>
<li><a href="https://blog.csdn.net/sui_yi123/article/details/83000512" target="_blank" rel="noopener">筛选和排序功能</a></li>
<li><a href="https://www.cnblogs.com/zj420255586/p/11761007.html" target="_blank" rel="noopener">创建多对多表关系的三种方式</a></li>
<li><a href="https://blog.csdn.net/qq_41631096/article/details/89309852" target="_blank" rel="noopener">Django 数据库数据关系多对多 添加 查询</a></li>
<li><a href="https://blog.csdn.net/kuangshp128/article/details/78946316" target="_blank" rel="noopener">外键属性定义</a></li>
<li><a href="https://blog.csdn.net/qianbin3200896/article/details/88165259" target="_blank" rel="noopener">搜索栏</a></li>
<li><a href="https://blog.csdn.net/qq_42269354/article/details/89874145" target="_blank" rel="noopener">搜索栏2</a></li>
</ul>

      </div>
      
      <footer class="post-footer">
        <div class="post-tags">
            <a href="/tags/Django/">Django</a>
            </div>
        
        <nav class="post-nav"><a class="next" href="/2020/03/27/17-A Complete Beginner`s Guide to Django -- Class-Based  Views/">
        <span class="next-text nav-default">A Complete Beginner`s Guide to Django -- Class-Based  Views</span>
        <span class="prev-text nav-mobile">下一篇</span>
        <i class="iconfont icon-right"></i>
      </a>
    </nav></footer>
    </article></div><div class="comments" id="comments"></div></div>
      </main>

      <footer id="footer" class="footer"><div class="social-links"><a href="mailto:afrunk7@gmail.com" class="iconfont icon-email" title="email"></a>
        <a href="https://github.com/afrunk" class="iconfont icon-github" title="github"></a>
        <a href="/atom.xml" class="iconfont icon-rss" title="rss"></a>
    </div><div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://hexo.io/">Hexo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/ahonn/hexo-theme-even">Even</a>
  </span>

  <span class="copyright-year">&copy;2019 - 2020<span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">Afrunk</span>
  </span>
</div>
</footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div><script type="text/javascript" src="/lib/jquery/jquery.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/lib/pjax/jquery.pjax.min.js"></script>
  <script type="text/javascript" src="/lib/nprogress/nprogress.min.js"></script>
  <script type="text/javascript" src="/js/src/even.js?v=2.11.0"></script>
</body>
</html>
