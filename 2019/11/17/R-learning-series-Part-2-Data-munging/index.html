<!DOCTYPE html>
<html lang>
  <head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">

<meta name="theme-color" content="#f8f5ec">
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="description" content="R learning series Part 2: Data munging"><meta name="keywords" content="R, 天道宫"><link rel="alternate" href="/default" title="天道宫"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.11.0">
<link rel="canonical" href="http://afrunk.github.io/2019/11/17/R-learning-series-Part-2-Data-munging/">

<link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css"><link rel="stylesheet" type="text/css" href="/lib/nprogress/nprogress.min.css"><script type="text/x-mathjax-config">
    MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });
  </script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.11.0">

<script id="baidu_push">
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<script>
  window.config = {"leancloud":{"app_id":null,"app_key":null},"toc":true,"fancybox":true,"pjax":true,"latex":true};
</script>

    <title>R learning series Part 2: Data munging - 天道宫</title>
  </head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">天道宫</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list"><a href="/">
        <li class="mobile-menu-item">Home
          </li>
      </a><a href="/archives/">
        <li class="mobile-menu-item">Archivew
          </li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags
          </li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories
          </li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About
          </li>
      </a></ul>
</nav>
<div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">天道宫</a>
</div>

<nav class="site-navbar"><ul id="menu" class="menu"><li class="menu-item">
          <a class="menu-item-link" href="/">
            Home
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            Archivew
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/tags/">
            Tags
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/categories/">
            Categories
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/about/">
            About
            </a>
        </li>
      </ul></nav>
</header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content"><article class="post">
    <header class="post-header">
      <h1 class="post-title">R learning series Part 2: Data munging
        </h1>

      <div class="post-meta">
        <span class="post-time">
          2019-11-17
        </span><span class="post-category">
            <a href="/categories/R-leaning-series/">R leaning series</a>
            </span>
        </div>
    </header>

    <div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">文章目录</h2>
    <div class="post-toc-content">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-分组操作"><span class="toc-text">1 分组操作</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-apply-函数族"><span class="toc-text">1.1 apply 函数族</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#A-apply-函数"><span class="toc-text">A apply 函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#B-lapply-和-sapply"><span class="toc-text">B lapply 和 sapply</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#C-mapply"><span class="toc-text">C mapply</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-aggregate"><span class="toc-text">1.2 aggregate</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-plyr"><span class="toc-text">1.3 plyr</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-4-data-table"><span class="toc-text">1.4 data.table</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-数据整理"><span class="toc-text">2 数据整理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-cbind-和-rbind"><span class="toc-text">2.1 cbind 和 rbind</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#A-cbind-合并向量"><span class="toc-text">A cbind 合并向量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#B-rbind"><span class="toc-text">B rbind</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-连接"><span class="toc-text">2.2 连接</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#A-merge"><span class="toc-text">A merge</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-reshape2"><span class="toc-text">2.3 reshape2</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Zero-宽数据"><span class="toc-text">Zero 宽数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#A-melt函数"><span class="toc-text">A melt函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#B-dcast-函数"><span class="toc-text">B dcast 函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-展开-colvar"><span class="toc-text">1. 展开 colvar</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-对观测变量进行聚合运算"><span class="toc-text">2. 对观测变量进行聚合运算</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-添加总"><span class="toc-text">3. 添加总</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-字符串操作"><span class="toc-text">3 字符串操作</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-paste"><span class="toc-text">3.1 paste</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-sprintf-格式数据写成串"><span class="toc-text">3.2 sprintf 格式数据写成串</span></a></li></ol></li></ol>
    </div>
  </div><div class="post-content"><p><strong>R Data munging</strong> ：数据分析的一般教养法则是处理数据，将耗费全部工作的80%精力，它需要对数据的不同部分反复操作，分离-操作-结合的过程。也就是说，我们先将数据根据某个标准分为几个离散的部分，然后对每个部分进行转换，最后重新组合转换后的部分，这有点类似 Hadoop 中的 MapReduce，在R中有许多不同的函数可以循环访问数据，本部分将介绍其中一些比较方便的函数。</p>
<a id="more"></a>
<p>整体系列安排如下：</p>
<ol>
<li><a href="https://afrunk.github.io/2019/11/14/R-basic-knowledge/">R basic knowledge</a></li>
<li><a href="https://afrunk.github.io/2019/11/17/R-learning-series-Part-2-Data-munging/">Data munging </a></li>
<li>概率分布方法</li>
<li>基本统计</li>
<li>线性模型和广义线性模型</li>
<li>模式诊断</li>
<li>正则化和压缩 用弹性网络和贝叶斯方法来防止过拟合</li>
<li>非线性模型</li>
<li>时间序列和自相关</li>
<li>聚类</li>
<li>knitr 包进行可重复性</li>
</ol>
<h1 id="1-分组操作"><a href="#1-分组操作" class="headerlink" title="1 分组操作"></a>1 分组操作</h1><h2 id="1-1-apply-函数族"><a href="#1-1-apply-函数族" class="headerlink" title="1.1 apply 函数族"></a>1.1 apply 函数族</h2><p>apply函数及其族类 tapply 函数、lapply 函数 和 mapply 函数都是R的内置函数。每一个都有其特点和存在的必要性，适用于不同的环境。</p>
<h3 id="A-apply-函数"><a href="#A-apply-函数" class="headerlink" title="A apply 函数"></a>A apply 函数</h3><p>apply 函数是被广泛运用的 apply 函数族的第一个成员，且其运用条件也最严格。它只能用于矩阵，这意味着要求所有的元素都是同一种数据类型，如字符型、数值型或者逻辑型。如果误用于其他类型，比如数据框，那么它会首先把数据转换成矩阵形式，再处理。</p>
<p>apply 函数的第一个参数为操作的矩阵对象。第二个参数是应用函数的维度，1代表对行进行处理，2代表对列进行处理，第三个参数为处理数据所调用的函数。所有的参数都将传递给调用的函数，apply将循环访问每一行并把它们作为单独的对象传递给将要调用的函数。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&gt; theMatrix &lt;- matrix(<span class="number">1</span>:<span class="number">9</span>,nrow=<span class="number">3</span>)</span><br><span class="line">&gt; print(theMatrix)</span><br><span class="line">     [,<span class="number">1</span>] [,<span class="number">2</span>] [,<span class="number">3</span>]</span><br><span class="line">[<span class="number">1</span>,]    <span class="number">1</span>    <span class="number">4</span>    <span class="number">7</span></span><br><span class="line">[<span class="number">2</span>,]    <span class="number">2</span>    <span class="number">5</span>    <span class="number">8</span></span><br><span class="line">[<span class="number">3</span>,]    <span class="number">3</span>    <span class="number">6</span>    <span class="number">9</span></span><br><span class="line">&gt; <span class="comment"># sum the rows</span></span><br><span class="line">&gt; apply(theMatrix,<span class="number">1</span>,sum)</span><br><span class="line">[<span class="number">1</span>] <span class="number">12</span> <span class="number">15</span> <span class="number">18</span></span><br><span class="line"><span class="comment"># sum the cols</span></span><br><span class="line">&gt; apply(theMatrix,<span class="number">2</span>,sum)</span><br><span class="line">[<span class="number">1</span>]  <span class="number">6</span> <span class="number">15</span> <span class="number">24</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 这里还可以使用R内置函数来求行和以及列和</span></span><br><span class="line">&gt; <span class="comment"># 内置行求和函数</span></span><br><span class="line">&gt; rowSums(theMatrix)</span><br><span class="line">[<span class="number">1</span>] <span class="number">12</span> <span class="number">15</span> <span class="number">18</span></span><br><span class="line">&gt; <span class="comment"># 内置列求和函数</span></span><br><span class="line">&gt; colSums(theMatrix)</span><br><span class="line">[<span class="number">1</span>]  <span class="number">6</span> <span class="number">15</span> <span class="number">24</span></span><br></pre></td></tr></table></figure>

<h3 id="B-lapply-和-sapply"><a href="#B-lapply-和-sapply" class="headerlink" title="B lapply 和 sapply"></a>B lapply 和 sapply</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&gt; theList &lt;- list(A = matrix(<span class="number">1</span>:<span class="number">9</span>,<span class="number">3</span>),B=<span class="number">1</span>:<span class="number">5</span>,c=matrix(<span class="number">1</span>:<span class="number">4</span>,<span class="number">2</span>),D=<span class="number">2</span>)</span><br><span class="line">&gt; print(theList)</span><br><span class="line">$A</span><br><span class="line">     [,<span class="number">1</span>] [,<span class="number">2</span>] [,<span class="number">3</span>]</span><br><span class="line">[<span class="number">1</span>,]    <span class="number">1</span>    <span class="number">4</span>    <span class="number">7</span></span><br><span class="line">[<span class="number">2</span>,]    <span class="number">2</span>    <span class="number">5</span>    <span class="number">8</span></span><br><span class="line">[<span class="number">3</span>,]    <span class="number">3</span>    <span class="number">6</span>    <span class="number">9</span></span><br><span class="line"></span><br><span class="line">$B</span><br><span class="line">[<span class="number">1</span>] <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span></span><br><span class="line"></span><br><span class="line">$c</span><br><span class="line">     [,<span class="number">1</span>] [,<span class="number">2</span>]</span><br><span class="line">[<span class="number">1</span>,]    <span class="number">1</span>    <span class="number">3</span></span><br><span class="line">[<span class="number">2</span>,]    <span class="number">2</span>    <span class="number">4</span></span><br><span class="line"></span><br><span class="line">$D</span><br><span class="line">[<span class="number">1</span>] <span class="number">2</span></span><br><span class="line"></span><br><span class="line">&gt; lapply(theList,sum)</span><br><span class="line">$A</span><br><span class="line">[<span class="number">1</span>] <span class="number">45</span></span><br><span class="line"></span><br><span class="line">$B</span><br><span class="line">[<span class="number">1</span>] <span class="number">15</span></span><br><span class="line"></span><br><span class="line">$c</span><br><span class="line">[<span class="number">1</span>] <span class="number">10</span></span><br><span class="line"></span><br><span class="line">$D</span><br><span class="line">[<span class="number">1</span>] <span class="number">2</span></span><br><span class="line"></span><br><span class="line">&gt; sapply(theList,sum)</span><br><span class="line"> A  B  c  D </span><br><span class="line"><span class="number">45</span> <span class="number">15</span> <span class="number">10</span>  <span class="number">2</span></span><br></pre></td></tr></table></figure>

<p>处理列表一般很麻烦，所以要用 lapply的结果转为向量，可以用 sapply 函数。除了返回值类型不一样，这两个函数在其他方面都是一样的<br><strong>由于向量在技术上为列表的一种形式，所以 lapply 和 sapply 函数都可以将向量作为输入值</strong></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt; theNames &lt;- c(<span class="string">"Jared"</span>,<span class="string">"Deb"</span>,<span class="string">"Paul"</span>)</span><br><span class="line">&gt; print(theNames)</span><br><span class="line">[<span class="number">1</span>] <span class="string">"Jared"</span> <span class="string">"Deb"</span>   <span class="string">"Paul"</span> </span><br><span class="line">&gt; lapply(theNames,nchar)</span><br><span class="line">[[<span class="number">1</span>]]</span><br><span class="line">[<span class="number">1</span>] <span class="number">5</span></span><br><span class="line"></span><br><span class="line">[[<span class="number">2</span>]]</span><br><span class="line">[<span class="number">1</span>] <span class="number">3</span></span><br><span class="line"></span><br><span class="line">[[<span class="number">3</span>]]</span><br><span class="line">[<span class="number">1</span>] <span class="number">4</span></span><br></pre></td></tr></table></figure>

<h3 id="C-mapply"><a href="#C-mapply" class="headerlink" title="C mapply"></a>C mapply</h3><p><strong>这个不知道有啥用！</strong></p>
<h2 id="1-2-aggregate"><a href="#1-2-aggregate" class="headerlink" title="1.2 aggregate"></a>1.2 aggregate</h2><p>我们使用之前的 ggplot2 的 数据集 diamonds,计算了 cut 各种类型（Fair,Good,Very Good,Premium 和 Ideal）的平均价格。函数 aggregate 的第一个参数是formula，其规定变量price 按照 cut类别分组，第二个参数为所用的数据来源，这个例子中为数据集 diamonds，第三个参数为应用于分组数据的函数，在这个例子中为函数 mean。</p>
<p>对于第一个参数，我们规定变量 price 按照分类变量 cut 进行函数统计。注意由于在第二个参数已经指明数据集，所以在第一个参数中只规定列名，不必识别数据来源。在第三个参数设置好调用函数后，可以添加额外的参数传递给被调用函数</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="keyword">require</span>(ggplot2)</span><br><span class="line">载入需要的程辑包：ggplot2</span><br><span class="line">&gt; data(<span class="string">"diamonds"</span>)</span><br><span class="line">&gt; head(diamonds)</span><br><span class="line"><span class="comment"># A tibble: 6 x 10</span></span><br><span class="line">  carat cut       color clarity depth table price     x     y     z</span><br><span class="line">  &lt;dbl&gt; &lt;ord&gt;     &lt;ord&gt; &lt;ord&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span><br><span class="line"><span class="number">1</span> <span class="number">0.23</span>  Ideal     E     SI2      <span class="number">61.5</span>    <span class="number">55</span>   <span class="number">326</span>  <span class="number">3.95</span>  <span class="number">3.98</span>  <span class="number">2.43</span></span><br><span class="line"><span class="number">2</span> <span class="number">0.21</span>  Premium   E     SI1      <span class="number">59.8</span>    <span class="number">61</span>   <span class="number">326</span>  <span class="number">3.89</span>  <span class="number">3.84</span>  <span class="number">2.31</span></span><br><span class="line"><span class="number">3</span> <span class="number">0.23</span>  Good      E     VS1      <span class="number">56.9</span>    <span class="number">65</span>   <span class="number">327</span>  <span class="number">4.05</span>  <span class="number">4.07</span>  <span class="number">2.31</span></span><br><span class="line"><span class="number">4</span> <span class="number">0.290</span> Premium   I     VS2      <span class="number">62.4</span>    <span class="number">58</span>   <span class="number">334</span>  <span class="number">4.2</span>   <span class="number">4.23</span>  <span class="number">2.63</span></span><br><span class="line"><span class="number">5</span> <span class="number">0.31</span>  Good      J     SI2      <span class="number">63.3</span>    <span class="number">58</span>   <span class="number">335</span>  <span class="number">4.34</span>  <span class="number">4.35</span>  <span class="number">2.75</span></span><br><span class="line"><span class="number">6</span> <span class="number">0.24</span>  Very Good J     VVS2     <span class="number">62.8</span>    <span class="number">57</span>   <span class="number">336</span>  <span class="number">3.94</span>  <span class="number">3.96</span>  <span class="number">2.48</span></span><br><span class="line"><span class="comment"># cut有关price的平均值</span></span><br><span class="line">&gt; aggregate(price ~ cut,diamonds,mean)</span><br><span class="line">        cut    price</span><br><span class="line"><span class="number">1</span>      Fair <span class="number">4358.758</span></span><br><span class="line"><span class="number">2</span>      Good <span class="number">3928.864</span></span><br><span class="line"><span class="number">3</span> Very Good <span class="number">3981.760</span></span><br><span class="line"><span class="number">4</span>   Premium <span class="number">4584.258</span></span><br><span class="line"><span class="number">5</span>     Ideal <span class="number">3457.542</span></span><br><span class="line"><span class="comment">#   cut 和 color 两个参数的有关price的平均值</span></span><br><span class="line">&gt; aggregate(price ~ cut+ color,diamonds,mean)</span><br><span class="line">         cut color    price</span><br><span class="line"><span class="number">1</span>       Fair     D <span class="number">4291.061</span></span><br><span class="line"><span class="number">2</span>       Good     D <span class="number">3405.382</span></span><br><span class="line"><span class="number">3</span>  Very Good     D <span class="number">3470.467</span></span><br><span class="line"><span class="number">4</span>    Premium     D <span class="number">3631.293</span></span><br><span class="line"><span class="number">5</span>      Ideal     D <span class="number">2629.095</span></span><br><span class="line"><span class="number">6</span>       Fair     E <span class="number">3682.312</span></span><br><span class="line"><span class="number">7</span>       Good     E <span class="number">3423.644</span></span><br><span class="line"><span class="number">8</span>  Very Good     E <span class="number">3214.652</span></span><br><span class="line"><span class="number">9</span>    Premium     E <span class="number">3538.914</span></span><br><span class="line"><span class="number">10</span>     Ideal     E <span class="number">2597.550</span></span><br><span class="line"><span class="number">11</span>      Fair     <span class="literal">F</span> <span class="number">3827.003</span></span><br><span class="line"><span class="number">12</span>      Good     <span class="literal">F</span> <span class="number">3495.750</span></span><br><span class="line"><span class="number">13</span> Very Good     <span class="literal">F</span> <span class="number">3778.820</span></span><br><span class="line"><span class="number">14</span>   Premium     <span class="literal">F</span> <span class="number">4324.890</span></span><br><span class="line"><span class="number">15</span>     Ideal     <span class="literal">F</span> <span class="number">3374.939</span></span><br><span class="line"><span class="number">16</span>      Fair     G <span class="number">4239.255</span></span><br><span class="line"><span class="number">17</span>      Good     G <span class="number">4123.482</span></span><br><span class="line"><span class="number">18</span> Very Good     G <span class="number">3872.754</span></span><br><span class="line"><span class="number">19</span>   Premium     G <span class="number">4500.742</span></span><br><span class="line"><span class="number">20</span>     Ideal     G <span class="number">3720.706</span></span><br><span class="line"><span class="number">21</span>      Fair     H <span class="number">5135.683</span></span><br><span class="line"><span class="number">22</span>      Good     H <span class="number">4276.255</span></span><br><span class="line"><span class="number">23</span> Very Good     H <span class="number">4535.390</span></span><br><span class="line"><span class="number">24</span>   Premium     H <span class="number">5216.707</span></span><br><span class="line"><span class="number">25</span>     Ideal     H <span class="number">3889.335</span></span><br><span class="line"><span class="number">26</span>      Fair     I <span class="number">4685.446</span></span><br><span class="line"><span class="number">27</span>      Good     I <span class="number">5078.533</span></span><br><span class="line"><span class="number">28</span> Very Good     I <span class="number">5255.880</span></span><br><span class="line"><span class="number">29</span>   Premium     I <span class="number">5946.181</span></span><br><span class="line"><span class="number">30</span>     Ideal     I <span class="number">4451.970</span></span><br><span class="line"><span class="number">31</span>      Fair     J <span class="number">4975.655</span></span><br><span class="line"><span class="number">32</span>      Good     J <span class="number">4574.173</span></span><br><span class="line"><span class="number">33</span> Very Good     J <span class="number">5103.513</span></span><br><span class="line"><span class="number">34</span>   Premium     J <span class="number">6294.592</span></span><br><span class="line"><span class="number">35</span>     Ideal     J <span class="number">4918.186</span></span><br><span class="line"><span class="comment"># 关于 cut 的 price 和 carat 的两个值分别的平均值</span></span><br><span class="line">&gt; aggregate( cbind(price,carat) ~ cut,diamonds,mean)</span><br><span class="line">        cut    price     carat</span><br><span class="line"><span class="number">1</span>      Fair <span class="number">4358.758</span> <span class="number">1.0461366</span></span><br><span class="line"><span class="number">2</span>      Good <span class="number">3928.864</span> <span class="number">0.8491847</span></span><br><span class="line"><span class="number">3</span> Very Good <span class="number">3981.760</span> <span class="number">0.8063814</span></span><br><span class="line"><span class="number">4</span>   Premium <span class="number">4584.258</span> <span class="number">0.8919549</span></span><br><span class="line"><span class="number">5</span>     Ideal <span class="number">3457.542</span> <span class="number">0.7028370</span></span><br><span class="line"><span class="comment"># 以 cut 和 color 分组的 price 和 carat的平均值</span></span><br><span class="line">&gt; aggregate(cbind(price,carat) ~ cut + color,diamonds,mean)</span><br><span class="line">         cut color    price     carat</span><br><span class="line"><span class="number">1</span>       Fair     D <span class="number">4291.061</span> <span class="number">0.9201227</span></span><br><span class="line"><span class="number">2</span>       Good     D <span class="number">3405.382</span> <span class="number">0.7445166</span></span><br><span class="line"><span class="number">3</span>  Very Good     D <span class="number">3470.467</span> <span class="number">0.6964243</span></span><br><span class="line"><span class="number">4</span>    Premium     D <span class="number">3631.293</span> <span class="number">0.7215471</span></span><br><span class="line"><span class="number">5</span>      Ideal     D <span class="number">2629.095</span> <span class="number">0.5657657</span></span><br><span class="line"><span class="number">6</span>       Fair     E <span class="number">3682.312</span> <span class="number">0.8566071</span></span><br><span class="line"><span class="number">7</span>       Good     E <span class="number">3423.644</span> <span class="number">0.7451340</span></span><br><span class="line"><span class="number">8</span>  Very Good     E <span class="number">3214.652</span> <span class="number">0.6763167</span></span><br><span class="line"><span class="number">9</span>    Premium     E <span class="number">3538.914</span> <span class="number">0.7177450</span></span><br><span class="line"><span class="number">10</span>     Ideal     E <span class="number">2597.550</span> <span class="number">0.5784012</span></span><br><span class="line"><span class="number">11</span>      Fair     <span class="literal">F</span> <span class="number">3827.003</span> <span class="number">0.9047115</span></span><br><span class="line"><span class="number">12</span>      Good     <span class="literal">F</span> <span class="number">3495.750</span> <span class="number">0.7759296</span></span><br><span class="line"><span class="number">13</span> Very Good     <span class="literal">F</span> <span class="number">3778.820</span> <span class="number">0.7409612</span></span><br><span class="line"><span class="number">14</span>   Premium     <span class="literal">F</span> <span class="number">4324.890</span> <span class="number">0.8270356</span></span><br><span class="line"><span class="number">15</span>     Ideal     <span class="literal">F</span> <span class="number">3374.939</span> <span class="number">0.6558285</span></span><br><span class="line"><span class="number">16</span>      Fair     G <span class="number">4239.255</span> <span class="number">1.0238217</span></span><br><span class="line"><span class="number">17</span>      Good     G <span class="number">4123.482</span> <span class="number">0.8508955</span></span><br><span class="line"><span class="number">18</span> Very Good     G <span class="number">3872.754</span> <span class="number">0.7667986</span></span><br><span class="line"><span class="number">19</span>   Premium     G <span class="number">4500.742</span> <span class="number">0.8414877</span></span><br><span class="line"><span class="number">20</span>     Ideal     G <span class="number">3720.706</span> <span class="number">0.7007146</span></span><br><span class="line"><span class="number">21</span>      Fair     H <span class="number">5135.683</span> <span class="number">1.2191749</span></span><br><span class="line"><span class="number">22</span>      Good     H <span class="number">4276.255</span> <span class="number">0.9147293</span></span><br><span class="line"><span class="number">23</span> Very Good     H <span class="number">4535.390</span> <span class="number">0.9159485</span></span><br><span class="line"><span class="number">24</span>   Premium     H <span class="number">5216.707</span> <span class="number">1.0164492</span></span><br><span class="line"><span class="number">25</span>     Ideal     H <span class="number">3889.335</span> <span class="number">0.7995249</span></span><br><span class="line"><span class="number">26</span>      Fair     I <span class="number">4685.446</span> <span class="number">1.1980571</span></span><br><span class="line"><span class="number">27</span>      Good     I <span class="number">5078.533</span> <span class="number">1.0572222</span></span><br><span class="line"><span class="number">28</span> Very Good     I <span class="number">5255.880</span> <span class="number">1.0469518</span></span><br><span class="line"><span class="number">29</span>   Premium     I <span class="number">5946.181</span> <span class="number">1.1449370</span></span><br><span class="line"><span class="number">30</span>     Ideal     I <span class="number">4451.970</span> <span class="number">0.9130291</span></span><br><span class="line"><span class="number">31</span>      Fair     J <span class="number">4975.655</span> <span class="number">1.3411765</span></span><br><span class="line"><span class="number">32</span>      Good     J <span class="number">4574.173</span> <span class="number">1.0995440</span></span><br><span class="line"><span class="number">33</span> Very Good     J <span class="number">5103.513</span> <span class="number">1.1332153</span></span><br><span class="line"><span class="number">34</span>   Premium     J <span class="number">6294.592</span> <span class="number">1.2930941</span></span><br><span class="line"><span class="number">35</span>     Ideal     J <span class="number">4918.186</span> <span class="number">1.0635937</span></span><br></pre></td></tr></table></figure>

<h2 id="1-3-plyr"><a href="#1-3-plyr" class="headerlink" title="1.3 plyr"></a>1.3 plyr</h2><p>书中给的 plyr 的例子很鲜明，但是是基于棒球比赛的，后续在实际的使用中碰到了在补充。</p>
<h2 id="1-4-data-table"><a href="#1-4-data-table" class="headerlink" title="1.4 data.table"></a>1.4 data.table</h2><ul>
<li>data.table</li>
<li>data.frame</li>
</ul>
<h1 id="2-数据整理"><a href="#2-数据整理" class="headerlink" title="2 数据整理"></a>2 数据整理</h1><p>这一部分我们开始考虑何时数据需要从面向列转变为面向行（或者相反），以及何时数据在多个独立集需要被合并称为一个数据集。R有许多基本函数可以完成这些任务，但是我们主要关注 plyr、reshape2和data.table 包中的那些。</p>
<h2 id="2-1-cbind-和-rbind"><a href="#2-1-cbind-和-rbind" class="headerlink" title="2.1 cbind 和 rbind"></a>2.1 cbind 和 rbind</h2><h3 id="A-cbind-合并向量"><a href="#A-cbind-合并向量" class="headerlink" title="A cbind 合并向量"></a>A cbind 合并向量</h3><h3 id="B-rbind"><a href="#B-rbind" class="headerlink" title="B rbind"></a>B rbind</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&gt; sport &lt;- c(<span class="string">"Hockey"</span>,<span class="string">"Baseball"</span>,<span class="string">"Football"</span>)</span><br><span class="line">&gt; league &lt;- c(<span class="string">"NHL"</span>,<span class="string">"MLB"</span>,<span class="string">"NFL"</span>)</span><br><span class="line">&gt; trophy &lt;- c(<span class="string">"Stanley cup"</span>,<span class="string">"Commissioner`s Trophy"</span>,<span class="string">"Vince Lombardi Tropht"</span>)</span><br><span class="line">&gt; trophiesl &lt;- cbind(sport,league,h)</span><br><span class="line">Error <span class="keyword">in</span> cbind(sport, league, h) : 找不到对象<span class="string">'h'</span></span><br><span class="line">&gt; trophiesl &lt;- cbind(sport,league,trophy)</span><br><span class="line">&gt; trophies2 &lt;- data.frame(sport = c(<span class="string">"Basketball"</span>,<span class="string">"Golf"</span>),league=c(<span class="string">"NBA"</span>,<span class="string">"PGA"</span>),trophy =c(<span class="string">"Larry o` Brien Champhionship Trophy"</span>,<span class="string">"Wanamake Trophy"</span>),stringsAsFactors = <span class="literal">FALSE</span>)</span><br><span class="line">&gt; trophies &lt;- rbind(trophiesl,trophies2)</span><br><span class="line">&gt; trophies</span><br><span class="line">       sport league                              trophy</span><br><span class="line"><span class="number">1</span>     Hockey    NHL                         Stanley cup</span><br><span class="line"><span class="number">2</span>   Baseball    MLB               Commissioner`s Trophy</span><br><span class="line">3   Football    NFL               Vince Lombardi Tropht</span><br><span class="line">4 Basketball    NBA Larry o` Brien Champhionship Trophy</span><br><span class="line"><span class="number">5</span>       Golf    PGA                     Wanamake Trophy</span><br><span class="line">&gt; trophiesl </span><br><span class="line">     sport      league trophy                 </span><br><span class="line">[<span class="number">1</span>,] <span class="string">"Hockey"</span>   <span class="string">"NHL"</span>  <span class="string">"Stanley cup"</span>          </span><br><span class="line">[<span class="number">2</span>,] <span class="string">"Baseball"</span> <span class="string">"MLB"</span>  <span class="string">"Commissioner`s Trophy"</span></span><br><span class="line">[<span class="number">3</span>,] <span class="string">"Football"</span> <span class="string">"NFL"</span>  <span class="string">"Vince Lombardi Tropht"</span></span><br><span class="line">&gt; trophies2</span><br><span class="line">       sport league                              trophy</span><br><span class="line"><span class="number">1</span> Basketball    NBA Larry o` Brien Champhionship Trophy</span><br><span class="line">2       Golf    PGA                     Wanamake Trophy</span><br></pre></td></tr></table></figure>

<h2 id="2-2-连接"><a href="#2-2-连接" class="headerlink" title="2.2 连接"></a>2.2 连接</h2><h3 id="A-merge"><a href="#A-merge" class="headerlink" title="A merge"></a>A merge</h3><p>merge有多种情况，参考链接如下：<a href="https://blog.csdn.net/u010652755/article/details/72982227" target="_blank" rel="noopener">R语言使用merge函数匹配数据</a></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建数据集</span></span><br><span class="line">&gt; name &lt;- c(<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'a'</span>,<span class="string">'d'</span>,<span class="string">'e'</span>)</span><br><span class="line">&gt; school &lt;- c(<span class="string">'s1'</span>,<span class="string">'s2'</span>,<span class="string">'s3'</span>,<span class="string">'s3'</span>,<span class="string">'s4'</span>,<span class="string">'s5'</span>)</span><br><span class="line">&gt; class &lt;- c(<span class="number">10</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">11</span>,<span class="number">1</span>,<span class="number">8</span>)</span><br><span class="line">&gt; English &lt;- c(<span class="number">80</span>,<span class="number">50</span>,<span class="number">90</span>,<span class="number">90</span>,<span class="number">12</span>,<span class="number">96</span>)</span><br><span class="line">&gt; w &lt;- data.frame(name,school,class,English)</span><br><span class="line">&gt; w</span><br><span class="line">  name school class English</span><br><span class="line"><span class="number">1</span>    a     s1    <span class="number">10</span>      <span class="number">80</span></span><br><span class="line"><span class="number">2</span>    b     s2     <span class="number">5</span>      <span class="number">50</span></span><br><span class="line"><span class="number">3</span>    c     s3     <span class="number">3</span>      <span class="number">90</span></span><br><span class="line"><span class="number">4</span>    a     s3    <span class="number">11</span>      <span class="number">90</span></span><br><span class="line"><span class="number">5</span>    d     s4     <span class="number">1</span>      <span class="number">12</span></span><br><span class="line"><span class="number">6</span>    e     s5     <span class="number">8</span>      <span class="number">96</span></span><br><span class="line">&gt; <span class="comment"># 同上创建数据集q</span></span><br><span class="line">&gt; name &lt;- c(<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'f'</span>)</span><br><span class="line">&gt; school &lt;- c(<span class="string">'s3'</span>,<span class="string">'s2'</span>,<span class="string">'s1'</span>,<span class="string">'s2'</span>)</span><br><span class="line">&gt; class &lt;-  c(<span class="number">5</span>, <span class="number">5</span>, <span class="number">1</span>,<span class="number">3</span>)</span><br><span class="line">&gt; maths &lt;- c(<span class="number">80</span>,<span class="number">89</span>,<span class="number">55</span>,<span class="number">90</span>)</span><br><span class="line">&gt; English &lt;- c(<span class="number">88</span>, <span class="number">89</span>, <span class="number">32</span>, <span class="number">89</span>)</span><br><span class="line">&gt; q &lt;- data.frame(name, school, class, maths, English)</span><br><span class="line">&gt; q</span><br><span class="line">  name school class maths English</span><br><span class="line"><span class="number">1</span>    a     s3     <span class="number">5</span>    <span class="number">80</span>      <span class="number">88</span></span><br><span class="line"><span class="number">2</span>    b     s2     <span class="number">5</span>    <span class="number">89</span>      <span class="number">89</span></span><br><span class="line"><span class="number">3</span>    c     s1     <span class="number">1</span>    <span class="number">55</span>      <span class="number">32</span></span><br><span class="line"><span class="number">4</span>    f     s2     <span class="number">3</span>    <span class="number">90</span>      <span class="number">89</span></span><br><span class="line"><span class="comment"># 查看两个数据表的维度</span></span><br><span class="line">&gt; dim(w);dim(q);</span><br><span class="line">[<span class="number">1</span>] <span class="number">6</span> <span class="number">4</span></span><br><span class="line">[<span class="number">1</span>] <span class="number">4</span> <span class="number">5</span></span><br><span class="line"><span class="comment"># 查看数据集的列名字</span></span><br><span class="line"><span class="comment"># 可以查看到两个数据集有公共列</span></span><br><span class="line">&gt; names(w);names(q);</span><br><span class="line">[<span class="number">1</span>] <span class="string">"name"</span>    <span class="string">"school"</span>  <span class="string">"class"</span>   <span class="string">"English"</span></span><br><span class="line">[<span class="number">1</span>] <span class="string">"name"</span>    <span class="string">"school"</span>  <span class="string">"class"</span>   <span class="string">"maths"</span>   <span class="string">"English"</span></span><br><span class="line"><span class="comment"># 有多个公共列时 需指出使用哪一列作为连接列</span></span><br><span class="line">&gt; merge(w,q,by = intersect(names(w)[<span class="number">1</span>],names(q)[<span class="number">1</span>]))</span><br><span class="line">  name school.x class.x English.x school.y class.y</span><br><span class="line"><span class="number">1</span>    a       s1      <span class="number">10</span>        <span class="number">80</span>       s3       <span class="number">5</span></span><br><span class="line"><span class="number">2</span>    a       s3      <span class="number">11</span>        <span class="number">90</span>       s3       <span class="number">5</span></span><br><span class="line"><span class="number">3</span>    b       s2       <span class="number">5</span>        <span class="number">50</span>       s2       <span class="number">5</span></span><br><span class="line"><span class="number">4</span>    c       s3       <span class="number">3</span>        <span class="number">90</span>       s1       <span class="number">1</span></span><br><span class="line">  maths English.y</span><br><span class="line"><span class="number">1</span>    <span class="number">80</span>        <span class="number">88</span></span><br><span class="line"><span class="number">2</span>    <span class="number">80</span>        <span class="number">88</span></span><br><span class="line"><span class="number">3</span>    <span class="number">89</span>        <span class="number">89</span></span><br><span class="line"><span class="number">4</span>    <span class="number">55</span>        <span class="number">32</span></span><br><span class="line"><span class="comment"># outer模式 将两种表的数据汇总 表中原来没有的数据置为空</span></span><br><span class="line"><span class="comment"># all =TRUE 表示选取 w q数据集的所有行 sort=TRUE 表示按 by列进行排序默认升序</span></span><br><span class="line">&gt; merge(w,q,all=<span class="literal">TRUE</span>,sort=<span class="literal">TRUE</span>)</span><br><span class="line">   name school class English maths</span><br><span class="line"><span class="number">1</span>     a     s1    <span class="number">10</span>      <span class="number">80</span>    <span class="literal">NA</span></span><br><span class="line"><span class="number">2</span>     a     s3     <span class="number">5</span>      <span class="number">88</span>    <span class="number">80</span></span><br><span class="line"><span class="number">3</span>     a     s3    <span class="number">11</span>      <span class="number">90</span>    <span class="literal">NA</span></span><br><span class="line"><span class="number">4</span>     b     s2     <span class="number">5</span>      <span class="number">50</span>    <span class="literal">NA</span></span><br><span class="line"><span class="number">5</span>     b     s2     <span class="number">5</span>      <span class="number">89</span>    <span class="number">89</span></span><br><span class="line"><span class="number">6</span>     c     s1     <span class="number">1</span>      <span class="number">32</span>    <span class="number">55</span></span><br><span class="line"><span class="number">7</span>     c     s3     <span class="number">3</span>      <span class="number">90</span>    <span class="literal">NA</span></span><br><span class="line"><span class="number">8</span>     d     s4     <span class="number">1</span>      <span class="number">12</span>    <span class="literal">NA</span></span><br><span class="line"><span class="number">9</span>     e     s5     <span class="number">8</span>      <span class="number">96</span>    <span class="literal">NA</span></span><br><span class="line"><span class="number">10</span>    f     s2     <span class="number">3</span>      <span class="number">89</span>    <span class="number">90</span></span><br></pre></td></tr></table></figure>

<h2 id="2-3-reshape2"><a href="#2-3-reshape2" class="headerlink" title="2.3 reshape2"></a>2.3 reshape2</h2><p>融合数据或铸造数据是我们这一部分的重点，数据重塑通常使用 reshape2 包，reshape2包用语实现对宽数据及长数据之间的相互转换，由于reshape2包不在r的默认安装包列表中，所以我们第一次使用需要安装和引用。</p>
<h3 id="Zero-宽数据"><a href="#Zero-宽数据" class="headerlink" title="Zero 宽数据"></a>Zero 宽数据</h3><p>在同一行，标识变量（一列或多列）能够唯一标识两个或多个变量的值，这种数据显示叫做数据的宽格式，也叫做宽数据；下面例子中 ID和 Time就是宽数据</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 认识宽数据</span></span><br><span class="line">&gt; install.packages(<span class="string">"reshape2"</span>)</span><br><span class="line">&gt; <span class="keyword">library</span>(reshape2)</span><br><span class="line"><span class="comment"># 创建示例数据，ID和Time的组合是唯一的，x1和x2是该行的观测变量值</span></span><br><span class="line"><span class="comment"># ID和 Time 的组合是唯一的 同一行有两个变量，通过ID和 Time 能够唯一确定变量x1和 x2的值</span></span><br><span class="line">&gt; ID &lt;- c(<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>)</span><br><span class="line">&gt; Time &lt;- c(<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line">&gt; x1 &lt;- c(<span class="number">5</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">2</span>)</span><br><span class="line">&gt; x2 &lt;- c(<span class="number">6</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">4</span>)</span><br><span class="line">&gt; mydata &lt;- data.frame(ID,Time,x1,x2)</span><br><span class="line">&gt; mydata</span><br><span class="line">  ID Time x1 x2</span><br><span class="line"><span class="number">1</span>  <span class="number">1</span>    <span class="number">1</span>  <span class="number">5</span>  <span class="number">6</span></span><br><span class="line"><span class="number">2</span>  <span class="number">1</span>    <span class="number">2</span>  <span class="number">3</span>  <span class="number">5</span></span><br><span class="line"><span class="number">3</span>  <span class="number">2</span>    <span class="number">1</span>  <span class="number">6</span>  <span class="number">1</span></span><br><span class="line"><span class="number">4</span>  <span class="number">2</span>    <span class="number">2</span>  <span class="number">2</span>  <span class="number">4</span></span><br></pre></td></tr></table></figure>

<h3 id="A-melt函数"><a href="#A-melt函数" class="headerlink" title="A melt函数"></a>A melt函数</h3><p>数据的融合是指把数据集重塑为特定的格式，使得每个观测变量独占一行，每行都有唯一确定每个观测变量所需要的标识变量，融合之后的数据，称为长格式，也叫做长数据。</p>
<p>原始数据中，主键列唯一确定 variable1 和 variable2的值，在融合之后，主键列和variable列唯一确定value列的值</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt; md &lt;- melt(mydata,id=c(<span class="string">"ID"</span>,<span class="string">"Time"</span>),measure=c(<span class="string">"x1"</span>,<span class="string">"x2"</span>))</span><br><span class="line">&gt; md</span><br><span class="line">  ID Time variable value</span><br><span class="line"><span class="number">1</span>  <span class="number">1</span>    <span class="number">1</span>       x1     <span class="number">5</span></span><br><span class="line"><span class="number">2</span>  <span class="number">1</span>    <span class="number">2</span>       x1     <span class="number">3</span></span><br><span class="line"><span class="number">3</span>  <span class="number">2</span>    <span class="number">1</span>       x1     <span class="number">6</span></span><br><span class="line"><span class="number">4</span>  <span class="number">2</span>    <span class="number">2</span>       x1     <span class="number">2</span></span><br><span class="line"><span class="number">5</span>  <span class="number">1</span>    <span class="number">1</span>       x2     <span class="number">6</span></span><br><span class="line"><span class="number">6</span>  <span class="number">1</span>    <span class="number">2</span>       x2     <span class="number">5</span></span><br><span class="line"><span class="number">7</span>  <span class="number">2</span>    <span class="number">1</span>       x2     <span class="number">1</span></span><br><span class="line"><span class="number">8</span>  <span class="number">2</span>    <span class="number">2</span>       x2     <span class="number">4</span></span><br></pre></td></tr></table></figure>

<p>数据融合之后，变成长数据，长数据的特征是ID列+变量名 唯一确定变量的值，并且每一行只能确定一个变量的值。注意：必须指定唯一确定每个观测所需的变量（ID和Time），而表示观测变量名的变量（X1和X2）由程序自动创建，从结果中可以看出，函数自动创建了两个变量：variable和value，这两个变量名称是默认的，这可以在melt()函数中，通过参数 variable.name=”new_variable_name”和 value.name=”new_value_name”来自定义。</p>
<h3 id="B-dcast-函数"><a href="#B-dcast-函数" class="headerlink" title="B dcast 函数"></a>B dcast 函数</h3><p>dcast()函数用语读取已融合的数据库（d是指data frame），并使用formula和用于整合数据的函数把数据集重塑成任意形状</p>
<h4 id="1-展开-colvar"><a href="#1-展开-colvar" class="headerlink" title="1. 展开 colvar"></a>1. 展开 colvar</h4><p>展开 colvar的过程，实际上是把列值转换为列名称的过程，这种展开操作是由 formula参数决定的。<br>重塑操作的特例是数据融合的逆操作，把数据的长格式转化为数据的宽格式，即，把已融合的数据转换为原始数据格式，对于这种操作，formula参数的格式是固定的：标志变量~variable。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; dcast(md,ID+Time~variable)</span><br><span class="line">  ID Time x1 x2</span><br><span class="line"><span class="number">1</span>  <span class="number">1</span>    <span class="number">1</span>  <span class="number">5</span>  <span class="number">6</span></span><br><span class="line"><span class="number">2</span>  <span class="number">1</span>    <span class="number">2</span>  <span class="number">3</span>  <span class="number">5</span></span><br><span class="line"><span class="number">3</span>  <span class="number">2</span>    <span class="number">1</span>  <span class="number">6</span>  <span class="number">1</span></span><br><span class="line"><span class="number">4</span>  <span class="number">2</span>    <span class="number">2</span>  <span class="number">2</span>  <span class="number">4</span></span><br></pre></td></tr></table></figure>

<h4 id="2-对观测变量进行聚合运算"><a href="#2-对观测变量进行聚合运算" class="headerlink" title="2. 对观测变量进行聚合运算"></a>2. 对观测变量进行聚合运算</h4><p>按照ID，计算观测变量的平均值</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; dcast(md,ID~variable,mean)</span><br><span class="line">  ID x1  x2</span><br><span class="line"><span class="number">1</span>  <span class="number">1</span>  <span class="number">4</span> <span class="number">5.5</span></span><br><span class="line"><span class="number">2</span>  <span class="number">2</span>  <span class="number">4</span> <span class="number">2.5</span></span><br></pre></td></tr></table></figure>

<h4 id="3-添加总"><a href="#3-添加总" class="headerlink" title="3. 添加总"></a>3. 添加总</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; dcast(md,ID~variable,mean,margins = c(<span class="string">"ID"</span>,<span class="string">"variable"</span>))</span><br><span class="line">     ID x1  x2 (all)</span><br><span class="line"><span class="number">1</span>     <span class="number">1</span>  <span class="number">4</span> <span class="number">5.5</span>  <span class="number">4.75</span></span><br><span class="line"><span class="number">2</span>     <span class="number">2</span>  <span class="number">4</span> <span class="number">2.5</span>  <span class="number">3.25</span></span><br><span class="line"><span class="number">3</span> (all)  <span class="number">4</span> <span class="number">4.0</span>  <span class="number">4.00</span></span><br></pre></td></tr></table></figure>

<h1 id="3-字符串操作"><a href="#3-字符串操作" class="headerlink" title="3 字符串操作"></a>3 字符串操作</h1><h2 id="3-1-paste"><a href="#3-1-paste" class="headerlink" title="3.1 paste"></a>3.1 paste</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; paste(<span class="string">"hello"</span>,<span class="string">"jared"</span>,<span class="string">"and others"</span>)</span><br><span class="line">[<span class="number">1</span>] <span class="string">"hello jared and others"</span></span><br></pre></td></tr></table></figure>

<h2 id="3-2-sprintf-格式数据写成串"><a href="#3-2-sprintf-格式数据写成串" class="headerlink" title="3.2 sprintf 格式数据写成串"></a>3.2 sprintf 格式数据写成串</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; person &lt;- <span class="string">"jared"</span></span><br><span class="line">&gt; partysize &lt;- <span class="string">"eight"</span></span><br><span class="line">&gt; waittime &lt;- <span class="number">25</span></span><br><span class="line">&gt; sprintf(<span class="string">"hello %s,your party of %s will be seated in %s minutes"</span>,person,partysize,waittime)</span><br><span class="line">[<span class="number">1</span>] <span class="string">"hello jared,your party of eight will be seated in 25 minutes"</span></span><br></pre></td></tr></table></figure>
      </div>
      <div class="post-copyright">
    <p class="copyright-item">
      <span>原文作者: </span>
      <a href="http://afrunk.github.io">Afrunk</a>
    </p>
    <p class="copyright-item">
      <span>原文链接: </span>
      <a href="http://afrunk.github.io/2019/11/17/R-learning-series-Part-2-Data-munging/">http://afrunk.github.io/2019/11/17/R-learning-series-Part-2-Data-munging/</a>
    </p>
    <p class="copyright-item">
      <span>许可协议: </span><a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank">知识共享署名-非商业性使用 4.0 国际许可协议</a>
    </p>
  </div>
      <footer class="post-footer">
        <div class="post-tags">
            <a href="/tags/R/">R</a>
            </div>
        
        <nav class="post-nav"><a class="prev" href="/2019/11/22/Linux-Guide/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">Linux Guide</span>
        <span class="prev-text nav-mobile">上一篇</span>
      </a>
    <a class="next" href="/2019/11/14/R-basic-knowledge/">
        <span class="next-text nav-default">R leaning series Part 1:R basic knowledge</span>
        <span class="prev-text nav-mobile">下一篇</span>
        <i class="iconfont icon-right"></i>
      </a>
    </nav></footer>
    </article></div><div class="comments" id="comments"></div></div>
      </main>

      <footer id="footer" class="footer"><div class="social-links"><a href="mailto:afrunk7@gmail.com" class="iconfont icon-email" title="email"></a>
        <a href="https://github.com/afrunk" class="iconfont icon-github" title="github"></a>
        <a href="/atom.xml" class="iconfont icon-rss" title="rss"></a>
    </div><div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://hexo.io/">Hexo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/ahonn/hexo-theme-even">Even</a>
  </span>

  <span class="copyright-year">&copy;2019<span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">Afrunk</span>
  </span>
</div>
</footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div><script type="text/javascript" src="/lib/jquery/jquery.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/lib/pjax/jquery.pjax.min.js"></script>
  <script type="text/javascript" src="/lib/nprogress/nprogress.min.js"></script>
  <script type="text/javascript" src="/js/src/even.js?v=2.11.0"></script>
</body>
</html>
